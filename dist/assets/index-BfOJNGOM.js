(function(){const l=document.createElement("link").relList;if(l&&l.supports&&l.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))a(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const r of i.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&a(r)}).observe(document,{childList:!0,subtree:!0});function o(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function a(n){if(n.ep)return;n.ep=!0;const i=o(n);fetch(n.href,i)}})();let d=null,y="singleplayer",f={roomId:null,playerNumber:null,opponentId:null};const s={GRAVITY:1200,MOVE_SPEED:250,BALL_GRAVITY:800,PLAYER_WIDTH:30,PLAYER_HEIGHT:60,BALL_RADIUS:10,COURT_FLOOR_Y:500,HOOP_LEFT_X:100,HOOP_RIGHT_X:700,HOOP_Y:250,HOOP_RADIUS:35,BLOCK_RANGE:80,STEAL_RANGE:40,WIN_SCORE:21,GAME_TIME:300,POWERUP_SPAWN_INTERVAL:8,POWERUP_DURATION:10,POWERUP_SIZE:20,POWERUP_PICKUP_RANGE:40},ae={speed:{label:"Speed Boost",icon:"âš¡",desc:"+10% move speed per level",costs:[50,150,400],maxLevel:3},jump:{label:"Jump Power",icon:"ðŸ¦˜",desc:"+10% jump height per level",costs:[50,150,400],maxLevel:3},accuracy:{label:"Shot Control",icon:"ðŸŽ¯",desc:"Accuracy meter 10% slower per level",costs:[75,200,500],maxLevel:3},steal:{label:"Steal Range",icon:"ðŸ¤š",desc:"+15% steal/pickup range per level",costs:[75,200,500],maxLevel:3}},A={blue:{label:"Blue Player",color:"#2196F3",cost:100},purple:{label:"Purple Player",color:"#9C27B0",cost:100},gold:{label:"Gold Player",color:"#FFD700",cost:250},trail:{label:"Speed Trail",color:null,cost:300}};let u={coins:0,upgrades:{speed:0,jump:0,accuracy:0,steal:0},cosmetics:[],equippedColor:null,trailEnabled:!1};function ge(){try{const e=localStorage.getItem("basketball_progress");if(e){const l=JSON.parse(e);u={...u,...l}}}catch(e){console.warn("Could not load progress:",e)}C()}function Y(){try{localStorage.setItem("basketball_progress",JSON.stringify(u))}catch(e){console.warn("Could not save progress:",e)}}function L(e){const l=u.upgrades[e]||0;return e==="speed"||e==="jump"?1+l*.1:e==="accuracy"?1-l*.1:e==="steal"?1+l*.15:1}function k(){return u.equippedColor&&A[u.equippedColor]?A[u.equippedColor].color:"#4CAF50"}function C(){const e=document.getElementById("menu-coins");e&&(e.textContent=u.coins)}const E={PLAYING:"playing",GAME_OVER:"gameover"},t={state:E.PLAYING,score:{player:0,cpu:0},timeRemaining:s.GAME_TIME,player:{x:600,y:s.COURT_FLOOR_Y,vx:0,vy:0,width:s.PLAYER_WIDTH,height:s.PLAYER_HEIGHT,isGrounded:!0,hasJumped:!1,jumpTime:0,facingLeft:!0,defending:!1},cpu:{x:200,y:s.COURT_FLOOR_Y,vx:0,vy:0,width:s.PLAYER_WIDTH,height:s.PLAYER_HEIGHT,isGrounded:!0,hasJumped:!1,jumpTime:0,facingLeft:!1,defending:!1,nextAction:0},ball:{x:600,y:s.COURT_FLOOR_Y-20,vx:0,vy:0,owner:"player",inAir:!1,shotFrom:null},canvas:null,ctx:null,width:800,height:600,scale:1,keys:{},muted:!1,shotCharging:!1,shotStage:0,shotPower:0,lockedPower:0,shotAccuracy:0,accuracyDirection:1,timeScale:1,powerups:[],powerupTimer:0,playerEffects:{speed:0,highJump:0},cpuEffects:{speed:0,highJump:0}};let z=!1,Q=!1;function ie(){if(z||(t.canvas=document.getElementById("game-canvas"),t.ctx=t.canvas.getContext("2d"),Z(),window.addEventListener("resize",Z),ve(),He(),z=!0),be(),!Q){let o=function(a){const n=l?(a-l)/1e3:0;l=a,Pe(Math.min(n,.1)),Le(),requestAnimationFrame(o)};var e=o;Q=!0;let l=0;requestAnimationFrame(o)}}function be(){t.state=E.PLAYING,t.score={player:0,cpu:0},t.timeRemaining=s.GAME_TIME,t.shotCharging=!1,t.shotStage=0,t.shotPower=0,t.lockedPower=0,t.shotAccuracy=0,t.accuracyDirection=1,t.timeScale=1,t.powerups=[],t.powerupTimer=s.POWERUP_SPAWN_INTERVAL,t.playerEffects={speed:0,highJump:0},t.cpuEffects={speed:0,highJump:0},N("player"),R(),_()}function Z(){const l=t.canvas.parentElement.getBoundingClientRect(),o=window.devicePixelRatio||1;t.canvas.width=l.width*o,t.canvas.height=l.height*o,t.canvas.style.width=l.width+"px",t.canvas.style.height=l.height+"px",t.scale=l.width/t.width,t.ctx.scale(o,o)}const xe=()=>"ontouchstart"in window||navigator.maxTouchPoints>0;function ve(){document.addEventListener("keydown",e=>{t.keys[e.key.toLowerCase()]=!0,e.key===" "&&t.player.isGrounded&&!t.player.hasJumped&&S(t.player),e.key.toLowerCase()==="d"&&(t.player.defending=!0),e.key.toLowerCase()==="r"&&re()}),document.addEventListener("keyup",e=>{t.keys[e.key.toLowerCase()]=!1,e.key.toLowerCase()==="d"&&(t.player.defending=!1)}),t.canvas.addEventListener("mousedown",G),Ee()}function Ee(){const e=document.getElementById("dpad-left"),l=document.getElementById("dpad-right"),o=document.getElementById("btn-jump"),a=document.getElementById("btn-shoot"),n=document.getElementById("btn-defend");if(!e||!l||!o||!a||!n)return;const i=(r,c,p)=>{r.addEventListener("touchstart",m=>{m.preventDefault(),r.classList.add("active"),c()},{passive:!1}),r.addEventListener("touchend",m=>{m.preventDefault(),r.classList.remove("active"),p&&p()},{passive:!1}),r.addEventListener("touchcancel",m=>{r.classList.remove("active"),p&&p()}),r.addEventListener("mousedown",m=>{m.preventDefault(),r.classList.add("active"),c()}),r.addEventListener("mouseup",m=>{r.classList.remove("active"),p&&p()}),r.addEventListener("mouseleave",m=>{r.classList.remove("active"),p&&p()})};i(e,()=>{t.keys.arrowleft=!0},()=>{t.keys.arrowleft=!1}),i(l,()=>{t.keys.arrowright=!0},()=>{t.keys.arrowright=!1}),i(o,()=>{t.player.isGrounded&&!t.player.hasJumped&&S(t.player)},null),i(a,()=>{!t.player.isGrounded&&t.ball.owner==="player"&&G({preventDefault:()=>{}})},null),i(n,()=>{t.player.defending=!0},()=>{t.player.defending=!1}),t.canvas.addEventListener("touchstart",r=>{t.shotCharging&&t.shotStage>0&&(r.preventDefault(),G({preventDefault:()=>{}}))},{passive:!1})}function G(e){e.preventDefault(),!t.player.isGrounded&&t.ball.owner==="player"&&(t.shotStage===0?(t.shotCharging=!0,t.shotStage=1,t.shotPower=0,t.timeScale=0,h("jump")):t.shotStage===1?(t.lockedPower=t.shotPower,t.shotStage=2,t.shotAccuracy=50,h("jump")):t.shotStage===2&&(se(t.player),t.shotCharging=!1,t.shotStage=0,t.timeScale=1))}function S(e){if(e.isGrounded){let o=(e===t.player?t.playerEffects:t.cpuEffects).highJump>0?1.6:1;e===t.player&&(o*=L("jump")),e.vy=-500*o,e.isGrounded=!1,e.hasJumped=!0,e.jumpTime=0,h("jump")}}function se(e){if(t.ball.owner!==(e===t.player?"player":"cpu"))return;const l=e.jumpTime/.5,o=1-Math.abs(l-.5)*2,a=e===t.player?t.cpu:t.player;if(a.defending&&Math.abs(a.x-e.x)<s.BLOCK_RANGE&&Math.abs(a.y-e.y)<60&&Math.random()>.3){t.ball.vx=(Math.random()-.5)*200,t.ball.vy=-100,t.ball.owner=null,t.ball.inAir=!0,t.ball.shotFrom=null,h("block");return}let i;e===t.player?y==="multiplayer"&&f.playerNumber===2?i=s.HOOP_RIGHT_X:i=s.HOOP_LEFT_X:y==="multiplayer"&&f.playerNumber===2?i=s.HOOP_LEFT_X:i=s.HOOP_RIGHT_X;const r=s.HOOP_Y,c=i-e.x;r-(e.y-e.height/2);let p=.5;if(e===t.player&&t.shotCharging){const B=Math.abs(t.shotAccuracy-50);B<=10?p=1:B<=20?p=.8:p=.3-(B-20)/30*.3}else e===t.cpu&&(p=.7+Math.random()*.2);const m=o*.2+p*.8,g=Math.abs(e.x-i);let b=0;m>=.95?b=0:m>=.8?b=2:m>=.6?b=8:b=(1-m)*80;let O=1;e===t.player&&t.shotStage===2&&(t.lockedPower>=75?O=1:t.lockedPower>=50?O=.85+(t.lockedPower-50)/25*.15:O=.6+t.lockedPower/50*.25);const M=s.BALL_GRAVITY;let w;g<=150?w=120:g<350?w=180:w=250,w*=O;const W=e.y-e.height/2,J=Math.min(W,r)-w,j=W-J,fe=Math.sqrt(2*j/M),ye=r-J,me=Math.sqrt(2*ye/M),he=fe+me;let I=c/he,P=-Math.sqrt(2*M*j);const X=(Math.random()-.5)*b*Math.PI/180,$=Math.atan2(P,I),K=Math.sqrt(I*I+P*P);I=Math.cos($+X)*K,P=Math.sin($+X)*K,t.ball.vx=I,t.ball.vy=P,t.ball.owner=null,t.ball.inAir=!0,t.ball.shotFrom={x:e.x,y:e.y,shooter:e===t.player?"player":"cpu",targetHoop:i},y==="multiplayer"&&pe(),h("shoot")}function re(){t.score={player:0,cpu:0},t.timeRemaining=s.GAME_TIME,t.state=E.PLAYING,N("player"),R(),_()}function N(e){let l,o;y==="multiplayer"?f.playerNumber===1?(l=600,o=200):(l=200,o=600):(l=600,o=200),t.player.x=l,t.player.y=s.COURT_FLOOR_Y,t.player.vx=0,t.player.vy=0,t.player.isGrounded=!0,t.player.hasJumped=!1,t.player.defending=!1,t.cpu.x=o,t.cpu.y=s.COURT_FLOOR_Y,t.cpu.vx=0,t.cpu.vy=0,t.cpu.isGrounded=!0,t.cpu.hasJumped=!1,t.cpu.defending=!1,t.ball.owner=e==="player"?"cpu":"player",t.ball.inAir=!1,t.ball.vx=0,t.ball.vy=0,t.ball.owner==="player"?(t.ball.x=t.player.x,t.ball.y=t.player.y-20):(t.ball.x=t.cpu.x,t.ball.y=t.cpu.y-20)}const H=[{id:"speed",label:"SPEED",color:"#00E5FF",icon:"âš¡"},{id:"highJump",label:"HIGH JUMP",color:"#76FF03",icon:"ðŸ¦˜"}];function we(){const e=H[Math.floor(Math.random()*H.length)],l=200+Math.random()*400,o=s.COURT_FLOOR_Y-30-Math.random()*100;t.powerups.push({x:l,y:o,type:e.id,bobOffset:Math.random()*Math.PI*2,age:0})}function Ie(e){if(!(e<=0)){t.playerEffects.speed>0&&(t.playerEffects.speed-=e),t.playerEffects.highJump>0&&(t.playerEffects.highJump-=e),t.cpuEffects.speed>0&&(t.cpuEffects.speed-=e),t.cpuEffects.highJump>0&&(t.cpuEffects.highJump-=e),t.powerupTimer-=e,t.powerupTimer<=0&&t.powerups.length<2&&(we(),t.powerupTimer=s.POWERUP_SPAWN_INTERVAL);for(const l of t.powerups)l.age+=e;for(let l=t.powerups.length-1;l>=0;l--){const o=t.powerups[l],a=Math.sqrt(Math.pow(o.x-t.player.x,2)+Math.pow(o.y-t.player.y,2)),n=Math.sqrt(Math.pow(o.x-t.cpu.x,2)+Math.pow(o.y-t.cpu.y,2));a<s.POWERUP_PICKUP_RANGE?(t.playerEffects[o.type]=s.POWERUP_DURATION,t.powerups.splice(l,1),h("pickup")):n<s.POWERUP_PICKUP_RANGE&&y!=="multiplayer"&&(t.cpuEffects[o.type]=s.POWERUP_DURATION,t.powerups.splice(l,1))}}}function Pe(e){if(e<=0||t.state===E.GAME_OVER)return;const l=e*t.timeScale;if(t.state===E.PLAYING&&t.timeScale>0&&(t.timeRemaining-=e,t.timeRemaining<=0)){t.timeRemaining=0,Se();return}Ie(l),Te(l),Re(l),Oe(l),Ae(),t.shotCharging&&(t.shotStage===1?(t.shotPower+=e*50,t.shotPower>=100&&(t.shotPower=0)):t.shotStage===2&&(t.shotAccuracy+=t.accuracyDirection*e*70*L("accuracy"),t.shotAccuracy>=100?(t.shotAccuracy=100,t.accuracyDirection=-1):t.shotAccuracy<=0&&(t.shotAccuracy=0,t.accuracyDirection=1)))}function Te(e){const l=t.player,o=(t.playerEffects.speed>0?1.8:1)*L("speed");t.keys.arrowleft||t.keys.a?(l.vx=-250*o,l.facingLeft=!0):t.keys.arrowright||t.keys.d?(l.vx=s.MOVE_SPEED*o,l.facingLeft=!1):l.vx=0,l.isGrounded||(l.vy+=s.GRAVITY*e,l.jumpTime+=e),l.x+=l.vx*e,l.y+=l.vy*e,l.x=Math.max(50,Math.min(t.width-50,l.x)),l.y>=s.COURT_FLOOR_Y&&(l.y=s.COURT_FLOOR_Y,l.vy=0,l.isGrounded=!0,l.hasJumped=!1,l.jumpTime=0,t.shotCharging&&(t.shotCharging=!1,t.shotStage=0,t.timeScale=1)),et()}function Re(e){if(y==="multiplayer")return;const l=t.cpu,o=t.cpuEffects.speed>0?1.8:1;if(l.nextAction-=e,t.ball.owner==="cpu"){const a=s.HOOP_RIGHT_X-150;Math.abs(l.x-a)>20?(l.vx=(l.x<a?s.MOVE_SPEED:-250)*o,l.facingLeft=l.vx<0):(l.vx=0,l.isGrounded&&l.nextAction<=0?(S(l),l.nextAction=.3):!l.isGrounded&&l.jumpTime>.2&&l.jumpTime<.4&&se(l))}else t.ball.owner==="player"?(Math.abs(l.x-t.player.x)>50?(l.vx=(l.x<t.player.x?s.MOVE_SPEED*.8:-250*.8)*o,l.facingLeft=l.vx<0):(l.vx=0,l.defending=!t.player.isGrounded&&Math.random()>.5),l.isGrounded&&!t.player.isGrounded&&l.nextAction<=0&&Math.random()>.7&&(S(l),l.nextAction=1)):Math.abs(l.x-t.ball.x)>20?(l.vx=(l.x<t.ball.x?s.MOVE_SPEED:-250)*o,l.facingLeft=l.vx<0):l.vx=0;l.isGrounded||(l.vy+=s.GRAVITY*e,l.jumpTime+=e),l.x+=l.vx*e,l.y+=l.vy*e,l.x=Math.max(50,Math.min(t.width-50,l.x)),l.y>=s.COURT_FLOOR_Y&&(l.y=s.COURT_FLOOR_Y,l.vy=0,l.isGrounded=!0,l.hasJumped=!1,l.jumpTime=0)}function Oe(e){const l=y!=="multiplayer"||f.playerNumber===1;if(t.ball.owner==="player")t.ball.x=t.player.x,t.ball.y=t.player.y-t.player.height/2-s.BALL_RADIUS-5,t.ball.vx=0,t.ball.vy=0;else if(t.ball.owner==="cpu")t.ball.x=t.cpu.x,t.ball.y=t.cpu.y-t.cpu.height/2-s.BALL_RADIUS-5,t.ball.vx=0,t.ball.vy=0;else if(t.ball.inAir){if(l){t.ball.vy+=s.BALL_GRAVITY*e,t.ball.x+=t.ball.vx*e,t.ball.y+=t.ball.vy*e;const o=60,a=(n,i,r)=>{if(r.highJump>0&&!n.isGrounded){const c=t.ball.x-n.x,p=t.ball.y-(n.y-n.height/2);if(Math.sqrt(c*c+p*p)<o&&t.ball.shotFrom&&t.ball.shotFrom.shooter!==i)return t.ball.owner=i,t.ball.inAir=!1,t.ball.vx=0,t.ball.vy=0,t.ball.shotFrom=null,h("block"),y==="multiplayer"&&ne(i),!0}return!1};a(t.player,"player",t.playerEffects)||a(t.cpu,"cpu",t.cpuEffects),t.ball.inAir&&t.ball.y>=s.COURT_FLOOR_Y&&(t.ball.y=s.COURT_FLOOR_Y,t.ball.vy*=-.6,t.ball.vx*=.8,Math.abs(t.ball.vy)<20&&(t.ball.inAir=!1,t.ball.vy=0)),t.ball.inAir&&(t.ball.x<s.BALL_RADIUS||t.ball.x>t.width-s.BALL_RADIUS)&&(t.ball.vx*=-.7,t.ball.x=Math.max(s.BALL_RADIUS,Math.min(t.width-s.BALL_RADIUS,t.ball.x))),pe()}}else if(l){const o=Math.sqrt(Math.pow(t.ball.x-t.player.x,2)+Math.pow(t.ball.y-t.player.y,2)),a=Math.sqrt(Math.pow(t.ball.x-t.cpu.x,2)+Math.pow(t.ball.y-t.cpu.y,2));let n=null;const i=s.STEAL_RANGE*L("steal");o<i&&o<a?n="player":a<s.STEAL_RANGE&&a<=o&&(n="cpu"),n&&(t.ball.owner=n,h("pickup"),y==="multiplayer"&&ne(n))}}function Ae(){const e={x:s.HOOP_LEFT_X,y:s.HOOP_Y},l={x:s.HOOP_RIGHT_X,y:s.HOOP_Y};if(!t.ball.inAir||t.ball.vy<=0||!t.ball.shotFrom)return;const o=Math.abs(t.ball.shotFrom.x-t.ball.shotFrom.targetHoop);let a=s.HOOP_RADIUS;o<=150?a=s.HOOP_RADIUS+20:o<350?a=s.HOOP_RADIUS+5:a=s.HOOP_RADIUS-5;const n=y==="multiplayer"&&f.playerNumber===2?l:e,i=y==="multiplayer"&&f.playerNumber===2?e:l;if(Math.abs(t.ball.x-n.x)<a&&Math.abs(t.ball.y-n.y)<30&&t.ball.shotFrom.shooter==="player"){const r=ee(t.ball.shotFrom);t.ball.shotFrom=null,te("player",r)}if(t.ball.shotFrom&&Math.abs(t.ball.x-i.x)<a&&Math.abs(t.ball.y-i.y)<30&&t.ball.shotFrom.shooter==="cpu"){const r=ee(t.ball.shotFrom);t.ball.shotFrom=null,te("cpu",r)}}function ee(e){const l=Math.abs(e.x-e.targetHoop);return l>=350?5:l>150?3:2}function te(e,l){t.score[e]+=l,R(),h("score"),e==="player"&&tt(l);let o="";l===5?o="ðŸ”¥ 5 POINTS! Half-court shot!":l===3?o="ðŸŽ¯ 3-Pointer!":o="+2 Points";const a=e==="player"?o:`CPU Scores ${l} pts`;t.score[e]>=s.WIN_SCORE?(t.state=E.GAME_OVER,ce(e==="player")):(U(a,1500),setTimeout(()=>{N(e),_()},1500))}function Se(){t.state=E.GAME_OVER;const e=t.score.player>t.score.cpu,l=t.score.player===t.score.cpu;ce(e,l)}function ce(e,l){const o=e?100:l?50:25,a=t.score.player*5,n=o+a;u.coins+=n,Y(),C(),Ue(l?"TIE GAME!":e?"YOU WIN!":"YOU LOSE!",o,a,n)}function Le(){const e=t.ctx;e.fillStyle="#16213e",e.fillRect(0,0,t.width,t.height),Ce(),le(s.HOOP_LEFT_X,s.HOOP_Y),le(s.HOOP_RIGHT_X,s.HOOP_Y);let l,o;y==="multiplayer"?f.playerNumber===1?(l=k(),o="#e94560"):(l=k(),o="#4CAF50"):(l=k(),o="#e94560"),u.trailEnabled&&Math.abs(t.player.vx)>50&&Be(t.player,l),oe(t.cpu,o),oe(t.player,l),ke(),_e(),Fe(),t.shotCharging&&(e.fillStyle="rgba(0, 50, 100, 0.15)",e.fillRect(0,0,t.width,t.height),Me()),Ge()}function Ce(){const e=t.ctx;e.fillStyle="#d4a574",e.fillRect(0,s.COURT_FLOOR_Y,t.width,t.height-s.COURT_FLOOR_Y),e.strokeStyle="#ffffff",e.lineWidth=3,e.beginPath(),e.moveTo(t.width/2,0),e.lineTo(t.width/2,s.COURT_FLOOR_Y),e.stroke(),e.strokeStyle="rgba(255, 255, 255, 0.3)",e.lineWidth=2,e.beginPath(),e.arc(s.HOOP_LEFT_X,s.COURT_FLOOR_Y,150,0,Math.PI,!0),e.stroke(),e.beginPath(),e.arc(s.HOOP_RIGHT_X,s.COURT_FLOOR_Y,150,0,Math.PI,!0),e.stroke()}function le(e,l,o){const a=t.ctx;a.fillStyle="rgba(255, 255, 255, 0.8)",a.fillRect(e-3,l-60,6,80),a.strokeStyle="#ff6b35",a.lineWidth=4,a.beginPath(),a.arc(e,l,s.HOOP_RADIUS,0,Math.PI),a.stroke(),a.strokeStyle="rgba(255, 255, 255, 0.4)",a.lineWidth=1;for(let n=-1;n<=1;n++)a.beginPath(),a.moveTo(e+n*20,l),a.lineTo(e+n*15,l+40),a.stroke()}function oe(e,l){const o=t.ctx,a=e.x,n=e.y-e.height;o.fillStyle=l,o.fillRect(a-e.width/2,n,e.width,e.height),o.beginPath(),o.arc(a,n,12,0,Math.PI*2),o.fill(),e.defending&&(o.strokeStyle=l,o.lineWidth=4,o.beginPath(),o.moveTo(a-e.width/2,n+15),o.lineTo(a-e.width/2-20,n-10),o.stroke(),o.beginPath(),o.moveTo(a+e.width/2,n+15),o.lineTo(a+e.width/2+20,n-10),o.stroke()),o.strokeStyle="rgba(0, 0, 0, 0.3)",o.lineWidth=2,o.strokeRect(a-e.width/2,n,e.width,e.height)}function _e(){const e=t.ctx,l=e.createRadialGradient(t.ball.x-3,t.ball.y-3,2,t.ball.x,t.ball.y,s.BALL_RADIUS);l.addColorStop(0,"#ff8c42"),l.addColorStop(1,"#ff6b35"),e.fillStyle=l,e.beginPath(),e.arc(t.ball.x,t.ball.y,s.BALL_RADIUS,0,Math.PI*2),e.fill(),e.strokeStyle="#d64933",e.lineWidth=2,e.stroke()}function Me(){const e=t.ctx,l=y==="multiplayer"&&f.playerNumber===2?s.HOOP_RIGHT_X:s.HOOP_LEFT_X,o=s.HOOP_Y;e.strokeStyle="rgba(255, 215, 0, 0.6)",e.lineWidth=3,e.setLineDash([10,10]),e.beginPath(),e.moveTo(t.player.x,t.player.y-t.player.height/2),e.lineTo(l,o),e.stroke(),e.setLineDash([]),e.strokeStyle="rgba(255, 215, 0, 0.8)",e.lineWidth=3,e.beginPath(),e.arc(l,o,30,0,Math.PI*2),e.stroke(),e.beginPath(),e.moveTo(l-40,o),e.lineTo(l+40,o),e.moveTo(l,o-40),e.lineTo(l,o+40),e.stroke();const a=t.width/2-100,n=120,i=200,r=25;if(e.fillStyle="#fff",e.font="bold 18px Arial",e.textAlign="center",e.fillText(t.shotStage===1?"STEP 1: SET POWER":"STEP 2: SET ACCURACY",t.width/2,n-20),t.shotStage===1){e.fillStyle="rgba(0, 0, 0, 0.7)",e.fillRect(a-5,n-5,i+10,r+10),e.fillStyle="#333",e.fillRect(a,n,i,r),e.fillStyle="rgba(76, 175, 80, 0.4)",e.fillRect(a+i*.5,n,i*.5,r),e.fillStyle="rgba(255, 215, 0, 0.5)",e.fillRect(a+i*.75,n,i*.25,r);let c="#FF5722";t.shotPower>=75?c="#FFD700":t.shotPower>=50&&(c="#4CAF50"),e.fillStyle=c,e.fillRect(a,n,i*(t.shotPower/100),r),e.fillStyle="#fff",e.font="bold 14px Arial",e.textAlign="center",e.fillText("POWER",a+i/2,n-10),e.font="16px Arial",e.fillStyle="rgba(255, 255, 255, 0.9)",e.fillText("Click when in GOLD zone!",a+i/2,n+50)}else if(t.shotStage===2){e.fillStyle="#FFD700",e.font="bold 16px Arial",e.textAlign="center";let c="Power: ";t.lockedPower>=75?c+="PERFECT! â­":t.lockedPower>=50?c+="Good":c+="Weak",e.fillText(c,t.width/2,n-40)}if(t.shotStage===2){const c=n;e.fillStyle="rgba(0, 0, 0, 0.7)",e.fillRect(a-5,c-5,i+10,r+10),e.fillStyle="#333",e.fillRect(a,c,i,r),e.fillStyle="rgba(76, 175, 80, 0.6)",e.fillRect(a+i*.4,c,i*.2,r),e.fillStyle="rgba(255, 255, 0, 0.4)",e.fillRect(a+i*.45,c,i*.1,r);const p=a+i*(t.shotAccuracy/100);e.fillStyle="#FF5722",e.fillRect(p-3,c-2,6,r+4),e.fillStyle="#fff",e.font="bold 14px Arial",e.fillText("ACCURACY",a+i/2,c-10),e.font="16px Arial",e.fillStyle="rgba(255, 255, 255, 0.9)",e.fillText("Click when PERFECT!",a+i/2,c+50);const m=Math.abs(t.shotAccuracy-50);let g="",b="";m<=10?(g="PERFECT! â­",b="#FFD700"):m<=20?(g="Good",b="#4CAF50"):(g="Poor",b="#FF5722"),e.fillStyle=b,e.font="bold 18px Arial",e.fillText(g,a+i/2,c+70)}}function Be(e,l){const o=t.ctx,a=e.vx>0?-1:1;o.save();for(let n=1;n<=4;n++){const i=.15-n*.03;o.fillStyle=l,o.globalAlpha=Math.max(0,i),o.fillRect(e.x-e.width/2+a*n*12,e.y-e.height,e.width,e.height)}o.restore()}function ke(){const e=t.ctx;for(const l of t.powerups){const o=H.find(n=>n.id===l.type);if(!o)continue;const a=l.y+Math.sin(l.age*3+l.bobOffset)*6;e.save(),e.shadowColor=o.color,e.shadowBlur=15+Math.sin(l.age*4)*5,e.fillStyle=o.color,e.globalAlpha=.3,e.beginPath(),e.arc(l.x,a,s.POWERUP_SIZE+4,0,Math.PI*2),e.fill(),e.globalAlpha=.9,e.fillStyle=o.color,e.beginPath(),e.arc(l.x,a,s.POWERUP_SIZE,0,Math.PI*2),e.fill(),e.strokeStyle="#fff",e.lineWidth=2,e.stroke(),e.shadowBlur=0,e.globalAlpha=1,e.fillStyle="#fff",e.font="bold 18px Arial",e.textAlign="center",e.textBaseline="middle",e.fillText(o.icon,l.x,a),e.restore()}}function Fe(){const e=t.ctx,l=(o,a)=>{let n=[];a.speed>0&&n.push({color:"#00E5FF",icon:"âš¡",time:a.speed}),a.highJump>0&&n.push({color:"#76FF03",icon:"ðŸ¦˜",time:a.highJump});for(let i=0;i<n.length;i++){const r=n[i],c=o.x-(n.length-1)*12+i*24,p=o.y-o.height-30;r.time<2&&Math.floor(r.time*4)%2===0||(e.save(),e.shadowColor=r.color,e.shadowBlur=8,e.fillStyle=r.color,e.globalAlpha=.8,e.beginPath(),e.arc(c,p,10,0,Math.PI*2),e.fill(),e.shadowBlur=0,e.globalAlpha=1,e.fillStyle="#fff",e.font="12px Arial",e.textAlign="center",e.textBaseline="middle",e.fillText(r.icon,c,p),e.restore())}};l(t.player,t.playerEffects),l(t.cpu,t.cpuEffects)}function Ge(){const e=t.ctx;e.fillStyle="rgba(255, 255, 255, 0.7)",e.font="14px Arial",e.textAlign="left",xe()||e.fillText("CONTROLS: Arrow Keys/WASD = Move | SPACE = Jump | CLICK = Shoot | D = Defend",10,20),e.fillText("First to 21 wins! | 2pts (inside arc) | 3pts (outside arc) | 5pts (half-court)",10,40);const l=Math.floor(t.timeRemaining/60),o=Math.floor(t.timeRemaining%60),a=`${l}:${o.toString().padStart(2,"0")}`;e.font="bold 24px Arial",e.textAlign="center",e.fillStyle=t.timeRemaining<30?"#FF5722":"#fff",e.fillText(a,t.width/2,60)}function He(){document.getElementById("restart-btn").addEventListener("click",re),document.getElementById("mute-btn").addEventListener("click",We),R()}function R(){document.getElementById("level-number").textContent=`${t.score.player} - ${t.score.cpu}`}function U(e,l){const o=document.getElementById("message");o.textContent=e,o.classList.add("show"),l&&setTimeout(()=>_(),l)}function _(){document.getElementById("message").classList.remove("show")}function Ue(e,l,o,a){const n=document.getElementById("game-over-overlay");document.getElementById("game-over-result").textContent=e,document.getElementById("coin-base").textContent=l,document.getElementById("coin-bonus").textContent=o,document.getElementById("coin-total").textContent=a,document.getElementById("coin-balance").textContent=u.coins,n.style.display="flex"}function De(){document.getElementById("game-over-overlay").style.display="none"}function Ye(){document.getElementById("main-menu").style.display="none",document.getElementById("shop-screen").style.display="flex",q()}function Ne(){document.getElementById("shop-screen").style.display="none",document.getElementById("main-menu").style.display="block"}function q(){document.getElementById("shop-coins").textContent=u.coins;const e=document.getElementById("upgrades-list");e.innerHTML="";for(const[o,a]of Object.entries(ae)){const n=u.upgrades[o]||0,i=n>=a.maxLevel,r=i?null:a.costs[n],c=r!==null&&u.coins>=r,p=document.createElement("div");p.className="shop-card"+(i?" maxed":"");let m="";for(let g=0;g<a.maxLevel;g++)m+=`<span class="level-dot ${g<n?"filled":""}"></span>`;p.innerHTML=`
            <div class="shop-card-icon">${a.icon}</div>
            <div class="shop-card-info">
                <div class="shop-card-name">${a.label}</div>
                <div class="shop-card-desc">${a.desc}</div>
                <div class="shop-card-levels">${m}</div>
            </div>
            <button class="shop-buy-btn ${i?"maxed":c?"":"cant-afford"}"
                    ${i||!c?"disabled":""}>
                ${i?"MAX":`${r} coins`}
            </button>
        `,!i&&c&&p.querySelector(".shop-buy-btn").addEventListener("click",()=>{qe(o)}),e.appendChild(p)}const l=document.getElementById("cosmetics-list");l.innerHTML="";for(const[o,a]of Object.entries(A)){const n=u.cosmetics.includes(o),i=o==="trail"?u.trailEnabled:u.equippedColor===o,r=!n&&u.coins>=a.cost,c=document.createElement("div");c.className="shop-card cosmetic"+(i?" equipped":"");const p=a.color?`<div class="cosmetic-preview" style="background:${a.color}"></div>`:'<div class="cosmetic-preview trail-preview">âœ¨</div>';c.innerHTML=`
            ${p}
            <div class="shop-card-info">
                <div class="shop-card-name">${a.label}</div>
            </div>
            <button class="shop-buy-btn ${n?i?"equipped-btn":"equip-btn":r?"":"cant-afford"}"
                    ${!n&&!r?"disabled":""}>
                ${n?i?"Equipped":"Equip":`${a.cost} coins`}
            </button>
        `;const m=c.querySelector(".shop-buy-btn");!n&&r?m.addEventListener("click",()=>Ve(o)):n&&!i&&m.addEventListener("click",()=>de(o)),l.appendChild(c)}}function qe(e){const l=ae[e],o=u.upgrades[e]||0;if(o>=l.maxLevel)return;const a=l.costs[o];u.coins<a||(u.coins-=a,u.upgrades[e]=o+1,Y(),C(),q(),h("score"))}function Ve(e){const l=A[e];u.cosmetics.includes(e)||u.coins<l.cost||(u.coins-=l.cost,u.cosmetics.push(e),de(e),h("score"))}function de(e){e==="trail"?u.trailEnabled=!u.trailEnabled:u.equippedColor=u.equippedColor===e?null:e,Y(),q()}function We(){t.muted=!t.muted,document.getElementById("mute-btn").textContent=t.muted?"ðŸ”‡":"ðŸ”Š"}let F=null;function Je(){return F||(F=new(window.AudioContext||window.webkitAudioContext)),F}function h(e){if(!t.muted)try{const l=Je(),o=l.createOscillator(),a=l.createGain();o.connect(a),a.connect(l.destination);const n=l.currentTime;e==="jump"?(o.frequency.setValueAtTime(200,n),o.frequency.exponentialRampToValueAtTime(100,n+.1),a.gain.setValueAtTime(.08,n),a.gain.exponentialRampToValueAtTime(.01,n+.1),o.start(n),o.stop(n+.1)):e==="shoot"?(o.frequency.setValueAtTime(300,n),o.frequency.exponentialRampToValueAtTime(150,n+.15),a.gain.setValueAtTime(.1,n),a.gain.exponentialRampToValueAtTime(.01,n+.15),o.start(n),o.stop(n+.15)):e==="score"?(o.frequency.setValueAtTime(440,n),o.frequency.exponentialRampToValueAtTime(880,n+.2),a.gain.setValueAtTime(.12,n),a.gain.exponentialRampToValueAtTime(.01,n+.2),o.start(n),o.stop(n+.2)):e==="block"?(o.type="square",o.frequency.setValueAtTime(100,n),a.gain.setValueAtTime(.1,n),a.gain.exponentialRampToValueAtTime(.01,n+.1),o.start(n),o.stop(n+.1)):e==="pickup"&&(o.frequency.setValueAtTime(400,n),a.gain.setValueAtTime(.05,n),a.gain.exponentialRampToValueAtTime(.01,n+.05),o.start(n),o.stop(n+.05))}catch(l){console.warn("Audio error:",l)}}let x=!1,v=!1;function je(){try{d=io({transports:["websocket","polling"],timeout:5e3}),d.on("connect",()=>{console.log("Connected to server"),document.getElementById("lobby-status").textContent="Connected! Searching for opponent..."}),d.on("connect_error",e=>{console.error("Connection error:",e),document.getElementById("lobby-status").textContent="Connection failed. Please check server."}),d.on("waitingForOpponent",()=>{document.getElementById("lobby-status").textContent="Searching for opponent..."})}catch(e){console.error("Socket initialization error:",e),document.getElementById("lobby-status").textContent="Connection failed."}d.on("matchFound",e=>{f.roomId=e.roomId,f.playerNumber=e.playerNumber,f.opponentId=e.opponentId,x=!1,v=!1,Xe()}),d.on("opponentReadyState",e=>{v=e.ready,V(),x&&v&&D()}),d.on("bothReady",()=>{D()}),d.on("opponentLeftLobby",()=>{x=!1,v=!1,document.getElementById("lobby-status").textContent="Opponent left. Searching again...",ue(),d&&d.connected&&d.emit("findMatch")}),d.on("opponentMove",e=>{y==="multiplayer"&&(t.cpu.x=e.x,t.cpu.y=e.y,t.cpu.vx=e.vx,t.cpu.vy=e.vy,t.cpu.isGrounded=e.isGrounded,t.cpu.defending=e.defending)}),d.on("ballSync",e=>{y==="multiplayer"&&f.playerNumber===2&&(t.ball.x=e.x,t.ball.y=e.y,t.ball.vx=e.vx,t.ball.vy=e.vy,t.ball.inAir=e.inAir,e.owner==="player"?t.ball.owner="cpu":e.owner==="cpu"?t.ball.owner="player":t.ball.owner=e.owner,e.shotFrom?t.ball.shotFrom={...e.shotFrom,shooter:e.shotFrom.shooter==="player"?"cpu":"player"}:t.ball.shotFrom=null)}),d.on("scoreUpdate",e=>{y==="multiplayer"&&(f.playerNumber===1?(t.score.player=e.score.player1,t.score.cpu=e.score.player2):(t.score.player=e.score.player2,t.score.cpu=e.score.player1),R())}),d.on("opponentDisconnected",()=>{U("Opponent disconnected",null),setTimeout(()=>{T()},2e3)}),d.on("opponentLeft",()=>{U("Opponent left the game",null),setTimeout(()=>{T()},2e3)}),d.on("ballPickupSync",e=>{y==="multiplayer"&&(f.playerNumber===2?e.owner==="player"?t.ball.owner="cpu":e.owner==="cpu"?t.ball.owner="player":t.ball.owner=e.owner:t.ball.owner=e.owner,h("pickup"))})}function ue(){document.getElementById("main-menu").style.display="none",document.getElementById("ready-lobby").style.display="none",document.getElementById("game-container").style.display="none",document.getElementById("matchmaking-lobby").style.display="block"}function Xe(){document.getElementById("main-menu").style.display="none",document.getElementById("matchmaking-lobby").style.display="none",document.getElementById("game-container").style.display="none",document.getElementById("ready-lobby").style.display="block",V();const e=document.getElementById("ready-btn");e.textContent="Ready!",e.classList.remove("is-ready")}function V(){const e=document.getElementById("your-ready-status"),l=document.getElementById("opponent-ready-status");x?(e.textContent="Ready!",e.classList.remove("not-ready"),e.classList.add("ready")):(e.textContent="Not Ready",e.classList.remove("ready"),e.classList.add("not-ready")),v?(l.textContent="Ready!",l.classList.remove("not-ready"),l.classList.add("ready")):(l.textContent="Not Ready",l.classList.remove("ready"),l.classList.add("not-ready"))}function $e(){x=!x;const e=document.getElementById("ready-btn");x?(e.textContent="Waiting...",e.classList.add("is-ready")):(e.textContent="Ready!",e.classList.remove("is-ready")),V(),d&&f.roomId&&d.emit("playerReady",{roomId:f.roomId,ready:x}),x&&v&&D()}function D(){const e=document.createElement("div");e.className="countdown-overlay",e.id="countdown-overlay",document.body.appendChild(e);let l=3;function o(){l>0?(e.innerHTML=`<div class="countdown-number">${l}</div>`,l--,setTimeout(o,1e3)):(e.innerHTML='<div class="countdown-number">GO!</div>',setTimeout(()=>{e.remove(),Ke()},500))}o()}function Ke(){y="multiplayer",document.getElementById("main-menu").style.display="none",document.getElementById("matchmaking-lobby").style.display="none",document.getElementById("ready-lobby").style.display="none",document.getElementById("game-container").style.display="block",ie()}function ze(){y="singleplayer",document.getElementById("main-menu").style.display="none",document.getElementById("matchmaking-lobby").style.display="none",document.getElementById("ready-lobby").style.display="none",document.getElementById("game-container").style.display="block",ie()}function T(){y="singleplayer";const e=f.roomId;f={roomId:null,playerNumber:null,opponentId:null},x=!1,v=!1,document.getElementById("game-container").style.display="none",document.getElementById("matchmaking-lobby").style.display="none",document.getElementById("ready-lobby").style.display="none",document.getElementById("shop-screen").style.display="none",document.getElementById("game-over-overlay").style.display="none",document.getElementById("main-menu").style.display="block",document.getElementById("connection-status").textContent="",C();const l=document.getElementById("countdown-overlay");l&&l.remove(),d&&e&&d.emit("leaveRoom",{roomId:e})}function Qe(){d&&d.emit("cancelSearch"),T()}function Ze(){d&&f.roomId&&d.emit("leaveLobby",{roomId:f.roomId}),T()}function et(){y==="multiplayer"&&d&&f.roomId&&d.emit("playerMove",{roomId:f.roomId,x:t.player.x,y:t.player.y,vx:t.player.vx,vy:t.player.vy,isGrounded:t.player.isGrounded,defending:t.player.defending})}function pe(){y==="multiplayer"&&d&&f.roomId&&d.emit("ballUpdate",{roomId:f.roomId,x:t.ball.x,y:t.ball.y,vx:t.ball.vx,vy:t.ball.vy,inAir:t.ball.inAir,owner:t.ball.owner,shotFrom:t.ball.shotFrom})}function tt(e){y==="multiplayer"&&d&&f.roomId&&d.emit("playerScored",{roomId:f.roomId,scorer:f.playerNumber,points:e})}function ne(e){y==="multiplayer"&&d&&f.roomId&&d.emit("ballPickup",{roomId:f.roomId,owner:e})}window.addEventListener("DOMContentLoaded",()=>{console.log("DOM loaded, setting up menu..."),ge();const e=document.getElementById("vs-cpu-btn"),l=document.getElementById("multiplayer-btn"),o=document.getElementById("cancel-search-btn"),a=document.getElementById("ready-btn"),n=document.getElementById("leave-lobby-btn"),i=document.getElementById("shop-btn"),r=document.getElementById("shop-back-btn"),c=document.getElementById("game-over-continue-btn");e&&e.addEventListener("click",()=>{console.log("Single player clicked"),ze()}),l&&l.addEventListener("click",()=>{console.log("Multiplayer clicked"),ue(),document.getElementById("lobby-status").textContent="Connecting to server...",d||je(),setTimeout(()=>{d&&d.connected?(document.getElementById("lobby-status").textContent="Searching for opponent...",d.emit("findMatch")):document.getElementById("lobby-status").textContent="Connection failed. Please try again."},500)}),o&&o.addEventListener("click",()=>{console.log("Cancel search clicked"),Qe()}),a&&a.addEventListener("click",()=>{console.log("Ready clicked"),$e()}),n&&n.addEventListener("click",()=>{console.log("Leave lobby clicked"),Ze()}),i&&i.addEventListener("click",()=>Ye()),r&&r.addEventListener("click",()=>Ne()),c&&c.addEventListener("click",()=>{De(),T()})});
