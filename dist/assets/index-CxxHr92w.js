(function(){const l=document.createElement("link").relList;if(l&&l.supports&&l.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const s of a)if(s.type==="childList")for(const u of s.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&n(u)}).observe(document,{childList:!0,subtree:!0});function o(a){const s={};return a.integrity&&(s.integrity=a.integrity),a.referrerPolicy&&(s.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?s.credentials="include":a.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(a){if(a.ep)return;a.ep=!0;const s=o(a);fetch(a.href,s)}})();let r=null,y="singleplayer",c={roomId:null,playerNumber:null,opponentId:null};const i={GRAVITY:1200,MOVE_SPEED:250,BALL_GRAVITY:800,PLAYER_WIDTH:30,PLAYER_HEIGHT:60,BALL_RADIUS:10,COURT_FLOOR_Y:500,HOOP_LEFT_X:100,HOOP_RIGHT_X:700,HOOP_Y:250,HOOP_RADIUS:35,BLOCK_RANGE:80,STEAL_RANGE:40,WIN_SCORE:21,GAME_TIME:300},v={PLAYING:"playing",GAME_OVER:"gameover"},e={state:v.PLAYING,score:{player:0,cpu:0},timeRemaining:i.GAME_TIME,player:{x:600,y:i.COURT_FLOOR_Y,vx:0,vy:0,width:i.PLAYER_WIDTH,height:i.PLAYER_HEIGHT,isGrounded:!0,hasJumped:!1,jumpTime:0,facingLeft:!0,defending:!1},cpu:{x:200,y:i.COURT_FLOOR_Y,vx:0,vy:0,width:i.PLAYER_WIDTH,height:i.PLAYER_HEIGHT,isGrounded:!0,hasJumped:!1,jumpTime:0,facingLeft:!1,defending:!1,nextAction:0},ball:{x:600,y:i.COURT_FLOOR_Y-20,vx:0,vy:0,owner:"player",inAir:!1,shotFrom:null},canvas:null,ctx:null,width:800,height:600,scale:1,keys:{},muted:!1,shotCharging:!1,shotStage:0,shotPower:0,lockedPower:0,shotAccuracy:0,accuracyDirection:1,timeScale:1};function j(){e.canvas=document.getElementById("game-canvas"),e.ctx=e.canvas.getContext("2d"),D(),window.addEventListener("resize",D),oe(),he();let t=0;function l(o){const n=t?(o-t)/1e3:0;t=o,ne(Math.min(n,.1)),de(),requestAnimationFrame(l)}requestAnimationFrame(l)}function D(){const l=e.canvas.parentElement.getBoundingClientRect(),o=window.devicePixelRatio||1;e.canvas.width=l.width*o,e.canvas.height=l.height*o,e.canvas.style.width=l.width+"px",e.canvas.style.height=l.height+"px",e.scale=l.width/e.width,e.ctx.scale(o,o)}function oe(){document.addEventListener("keydown",t=>{e.keys[t.key.toLowerCase()]=!0,t.key===" "&&e.player.isGrounded&&!e.player.hasJumped&&I(e.player),t.key.toLowerCase()==="d"&&(e.player.defending=!0),t.key.toLowerCase()==="r"&&z()}),document.addEventListener("keyup",t=>{e.keys[t.key.toLowerCase()]=!1,t.key.toLowerCase()==="d"&&(e.player.defending=!1)}),e.canvas.addEventListener("mousedown",V),e.canvas.addEventListener("touchstart",t=>{t.preventDefault();const l=t.touches[0],o=e.canvas.getBoundingClientRect();l.clientX-o.left,l.clientY-o.top,!e.player.isGrounded&&e.ball.owner==="player"?V(t):e.player.isGrounded&&!e.player.hasJumped&&I(e.player)}),e.canvas.addEventListener("touchmove",t=>{t.preventDefault();const l=t.touches[0],o=e.canvas.getBoundingClientRect(),n=l.clientX-o.left;n<o.width/3?(e.keys.arrowleft=!0,e.keys.arrowright=!1):n>o.width*2/3?(e.keys.arrowright=!0,e.keys.arrowleft=!1):(e.keys.arrowleft=!1,e.keys.arrowright=!1)}),e.canvas.addEventListener("touchend",t=>{t.preventDefault(),e.keys.arrowleft=!1,e.keys.arrowright=!1})}function V(t){t.preventDefault(),!e.player.isGrounded&&e.ball.owner==="player"&&(e.shotStage===0?(e.shotCharging=!0,e.shotStage=1,e.shotPower=0,e.timeScale=0,p("jump")):e.shotStage===1?(e.lockedPower=e.shotPower,e.shotStage=2,e.shotAccuracy=50,p("jump")):e.shotStage===2&&(J(e.player),e.shotCharging=!1,e.shotStage=0,e.timeScale=1))}function I(t){t.isGrounded&&(t.vy=-500,t.isGrounded=!1,t.hasJumped=!0,t.jumpTime=0,p("jump"))}function J(t){if(e.ball.owner!==(t===e.player?"player":"cpu"))return;const l=t.jumpTime/.5,o=1-Math.abs(l-.5)*2,n=t===e.player?e.cpu:e.player;if(n.defending&&Math.abs(n.x-t.x)<i.BLOCK_RANGE&&Math.abs(n.y-t.y)<60&&Math.random()>.3){e.ball.vx=(Math.random()-.5)*200,e.ball.vy=-100,e.ball.owner=null,e.ball.inAir=!0,e.ball.shotFrom=null,p("block");return}const s=t===e.player?i.HOOP_LEFT_X:i.HOOP_RIGHT_X,u=i.HOOP_Y,d=s-t.x;u-(t.y-t.height/2);let h=.5;if(t===e.player&&e.shotCharging){const L=Math.abs(e.shotAccuracy-50);L<=10?h=1:L<=20?h=.8:h=.3-(L-20)/30*.3}else t===e.cpu&&(h=.7+Math.random()*.2);const g=o*.2+h*.8,b=Math.abs(t.x-s);let f=0;g>=.95?f=0:g>=.8?f=2:g>=.6?f=8:f=(1-g)*80;let R=1;t===e.player&&e.shotStage===2&&(e.lockedPower>=75?R=1:e.lockedPower>=50?R=.85+(e.lockedPower-50)/25*.15:R=.6+e.lockedPower/50*.25);const P=i.BALL_GRAVITY;let O;b<=150?O=120:b<350?O=180:O=250,O*=R;const B=t.y-t.height/2,F=Math.min(B,u)-O,G=B-F,Z=Math.sqrt(2*G/P),ee=u-F,te=Math.sqrt(2*ee/P),le=Z+te;let w=d/le,A=-Math.sqrt(2*P*G);const H=(Math.random()-.5)*f*Math.PI/180,U=Math.atan2(A,w),Y=Math.sqrt(w*w+A*A);w=Math.cos(U+H)*Y,A=Math.sin(U+H)*Y,e.ball.vx=w,e.ball.vy=A,e.ball.owner=null,e.ball.inAir=!0,e.ball.shotFrom={x:t.x,y:t.y,shooter:t===e.player?"player":"cpu",targetHoop:s},y==="multiplayer"&&Q(),p("shoot")}function z(){e.score={player:0,cpu:0},e.timeRemaining=i.GAME_TIME,e.state=v.PLAYING,$("player"),S(),M()}function $(t){e.player.x=600,e.player.y=i.COURT_FLOOR_Y,e.player.vx=0,e.player.vy=0,e.player.isGrounded=!0,e.player.hasJumped=!1,e.player.defending=!1,e.cpu.x=200,e.cpu.y=i.COURT_FLOOR_Y,e.cpu.vx=0,e.cpu.vy=0,e.cpu.isGrounded=!0,e.cpu.hasJumped=!1,e.cpu.defending=!1,e.ball.owner=t==="player"?"cpu":"player",e.ball.inAir=!1,e.ball.vx=0,e.ball.vy=0,e.ball.owner==="player"?(e.ball.x=e.player.x,e.ball.y=e.player.y-20):(e.ball.x=e.cpu.x,e.ball.y=e.cpu.y-20)}function ne(t){if(t<=0||e.state===v.GAME_OVER)return;const l=t*e.timeScale;if(e.state===v.PLAYING&&e.timeScale>0&&(e.timeRemaining-=t,e.timeRemaining<=0)){e.timeRemaining=0,ce();return}ae(l),ie(l),re(l),se(),e.shotCharging&&(e.shotStage===1?(e.shotPower+=t*100,e.shotPower>=100&&(e.shotPower=0)):e.shotStage===2&&(e.shotAccuracy+=e.accuracyDirection*t*150,e.shotAccuracy>=100?(e.shotAccuracy=100,e.accuracyDirection=-1):e.shotAccuracy<=0&&(e.shotAccuracy=0,e.accuracyDirection=1)))}function ae(t){const l=e.player;e.keys.arrowleft||e.keys.a?(l.vx=-250,l.facingLeft=!0):e.keys.arrowright||e.keys.d?(l.vx=i.MOVE_SPEED,l.facingLeft=!1):l.vx=0,l.isGrounded||(l.vy+=i.GRAVITY*t,l.jumpTime+=t),l.x+=l.vx*t,l.y+=l.vy*t,l.x=Math.max(50,Math.min(e.width-50,l.x)),l.y>=i.COURT_FLOOR_Y&&(l.y=i.COURT_FLOOR_Y,l.vy=0,l.isGrounded=!0,l.hasJumped=!1,l.jumpTime=0,e.shotCharging&&(e.shotCharging=!1,e.shotStage=0,e.timeScale=1)),Ie()}function ie(t){if(y==="multiplayer")return;const l=e.cpu;if(l.nextAction-=t,e.ball.owner==="cpu"){const o=i.HOOP_RIGHT_X-150;Math.abs(l.x-o)>20?(l.vx=l.x<o?i.MOVE_SPEED:-250,l.facingLeft=l.vx<0):(l.vx=0,l.isGrounded&&l.nextAction<=0?(I(l),l.nextAction=.3):!l.isGrounded&&l.jumpTime>.2&&l.jumpTime<.4&&J(l))}else e.ball.owner==="player"?(Math.abs(l.x-e.player.x)>50?(l.vx=l.x<e.player.x?i.MOVE_SPEED*.8:-250*.8,l.facingLeft=l.vx<0):(l.vx=0,l.defending=!e.player.isGrounded&&Math.random()>.5),l.isGrounded&&!e.player.isGrounded&&l.nextAction<=0&&Math.random()>.7&&(I(l),l.nextAction=1)):Math.abs(l.x-e.ball.x)>20?(l.vx=l.x<e.ball.x?i.MOVE_SPEED:-250,l.facingLeft=l.vx<0):l.vx=0;l.isGrounded||(l.vy+=i.GRAVITY*t,l.jumpTime+=t),l.x+=l.vx*t,l.y+=l.vy*t,l.x=Math.max(50,Math.min(e.width-50,l.x)),l.y>=i.COURT_FLOOR_Y&&(l.y=i.COURT_FLOOR_Y,l.vy=0,l.isGrounded=!0,l.hasJumped=!1,l.jumpTime=0)}function re(t){const l=y!=="multiplayer"||c.playerNumber===1;if(e.ball.owner==="player")e.ball.x=e.player.x,e.ball.y=e.player.y-e.player.height/2-i.BALL_RADIUS-5,e.ball.vx=0,e.ball.vy=0;else if(e.ball.owner==="cpu")e.ball.x=e.cpu.x,e.ball.y=e.cpu.y-e.cpu.height/2-i.BALL_RADIUS-5,e.ball.vx=0,e.ball.vy=0;else if(e.ball.inAir)l&&(e.ball.vy+=i.BALL_GRAVITY*t,e.ball.x+=e.ball.vx*t,e.ball.y+=e.ball.vy*t,e.ball.y>=i.COURT_FLOOR_Y&&(e.ball.y=i.COURT_FLOOR_Y,e.ball.vy*=-.6,e.ball.vx*=.8,Math.abs(e.ball.vy)<20&&(e.ball.inAir=!1,e.ball.vy=0)),(e.ball.x<i.BALL_RADIUS||e.ball.x>e.width-i.BALL_RADIUS)&&(e.ball.vx*=-.7,e.ball.x=Math.max(i.BALL_RADIUS,Math.min(e.width-i.BALL_RADIUS,e.ball.x))),Q());else if(l){const o=Math.sqrt(Math.pow(e.ball.x-e.player.x,2)+Math.pow(e.ball.y-e.player.y,2)),n=Math.sqrt(Math.pow(e.ball.x-e.cpu.x,2)+Math.pow(e.ball.y-e.cpu.y,2));let a=null;o<i.STEAL_RANGE&&o<n?a="player":n<i.STEAL_RANGE&&n<=o&&(a="cpu"),a&&(e.ball.owner=a,p("pickup"),y==="multiplayer"&&Se(a))}}function se(){const t={x:i.HOOP_LEFT_X,y:i.HOOP_Y},l={x:i.HOOP_RIGHT_X,y:i.HOOP_Y};if(e.ball.inAir&&e.ball.vy>0&&e.ball.shotFrom){const o=Math.abs(e.ball.shotFrom.x-e.ball.shotFrom.targetHoop);let n=i.HOOP_RADIUS;if(o<=150?n=i.HOOP_RADIUS+20:o<350?n=i.HOOP_RADIUS+5:n=i.HOOP_RADIUS-5,Math.abs(e.ball.x-t.x)<n&&Math.abs(e.ball.y-t.y)<30){const a=N(e.ball.shotFrom);e.ball.shotFrom=null,W("player",a)}}if(e.ball.inAir&&e.ball.vy>0&&e.ball.shotFrom){const o=Math.abs(e.ball.shotFrom.x-e.ball.shotFrom.targetHoop);let n=i.HOOP_RADIUS;if(o<=150?n=i.HOOP_RADIUS+20:o<350?n=i.HOOP_RADIUS+5:n=i.HOOP_RADIUS-5,Math.abs(e.ball.x-l.x)<n&&Math.abs(e.ball.y-l.y)<30){const a=N(e.ball.shotFrom);e.ball.shotFrom=null,W("cpu",a)}}}function N(t){const l=Math.abs(t.x-t.targetHoop);return l>=350?5:l>150?3:2}function W(t,l){e.score[t]+=l,S(),p("score"),t==="player"&&Ee(l);let o="";l===5?o="üî• 5 POINTS! Half-court shot!":l===3?o="üéØ 3-Pointer!":o="+2 Points";const n=t==="player"?o:`CPU Scores ${l} pts`;e.score[t]>=i.WIN_SCORE?(e.state=v.GAME_OVER,T(t==="player"?"YOU WIN! üèÜ":"CPU WINS!",null)):(T(n,1500),setTimeout(()=>{$(t),M()},1500))}function ce(){e.state=v.GAME_OVER,e.score.player>e.score.cpu?T("TIME'S UP! YOU WIN! üèÜ",null):e.score.cpu>e.score.player?T("TIME'S UP! CPU WINS!",null):T("TIME'S UP! TIE GAME! ü§ù",null)}function de(){const t=e.ctx;t.fillStyle="#16213e",t.fillRect(0,0,e.width,e.height),ue(),q(i.HOOP_LEFT_X,i.HOOP_Y),q(i.HOOP_RIGHT_X,i.HOOP_Y),X(e.cpu,"#e94560"),X(e.player,"#4CAF50"),ye(),e.shotCharging&&(t.fillStyle="rgba(0, 50, 100, 0.15)",t.fillRect(0,0,e.width,e.height),fe()),me(),pe()}function ue(){const t=e.ctx;t.fillStyle="#d4a574",t.fillRect(0,i.COURT_FLOOR_Y,e.width,e.height-i.COURT_FLOOR_Y),t.strokeStyle="#ffffff",t.lineWidth=3,t.beginPath(),t.moveTo(e.width/2,0),t.lineTo(e.width/2,i.COURT_FLOOR_Y),t.stroke(),t.strokeStyle="rgba(255, 255, 255, 0.3)",t.lineWidth=2,t.beginPath(),t.arc(i.HOOP_LEFT_X,i.COURT_FLOOR_Y,150,0,Math.PI,!0),t.stroke(),t.beginPath(),t.arc(i.HOOP_RIGHT_X,i.COURT_FLOOR_Y,150,0,Math.PI,!0),t.stroke()}function q(t,l,o){const n=e.ctx;n.fillStyle="rgba(255, 255, 255, 0.8)",n.fillRect(t-3,l-60,6,80),n.strokeStyle="#ff6b35",n.lineWidth=4,n.beginPath(),n.arc(t,l,i.HOOP_RADIUS,0,Math.PI),n.stroke(),n.strokeStyle="rgba(255, 255, 255, 0.4)",n.lineWidth=1;for(let a=-1;a<=1;a++)n.beginPath(),n.moveTo(t+a*20,l),n.lineTo(t+a*15,l+40),n.stroke()}function X(t,l){const o=e.ctx,n=t.x,a=t.y-t.height;o.fillStyle=l,o.fillRect(n-t.width/2,a,t.width,t.height),o.beginPath(),o.arc(n,a,12,0,Math.PI*2),o.fill(),t.defending&&(o.strokeStyle=l,o.lineWidth=4,o.beginPath(),o.moveTo(n-t.width/2,a+15),o.lineTo(n-t.width/2-20,a-10),o.stroke(),o.beginPath(),o.moveTo(n+t.width/2,a+15),o.lineTo(n+t.width/2+20,a-10),o.stroke()),o.strokeStyle="rgba(0, 0, 0, 0.3)",o.lineWidth=2,o.strokeRect(n-t.width/2,a,t.width,t.height)}function ye(){const t=e.ctx,l=t.createRadialGradient(e.ball.x-3,e.ball.y-3,2,e.ball.x,e.ball.y,i.BALL_RADIUS);l.addColorStop(0,"#ff8c42"),l.addColorStop(1,"#ff6b35"),t.fillStyle=l,t.beginPath(),t.arc(e.ball.x,e.ball.y,i.BALL_RADIUS,0,Math.PI*2),t.fill(),t.strokeStyle="#d64933",t.lineWidth=2,t.stroke()}function fe(){const t=e.ctx,l=i.HOOP_LEFT_X,o=i.HOOP_Y;t.strokeStyle="rgba(255, 215, 0, 0.6)",t.lineWidth=3,t.setLineDash([10,10]),t.beginPath(),t.moveTo(e.player.x,e.player.y-e.player.height/2),t.lineTo(l,o),t.stroke(),t.setLineDash([]),t.strokeStyle="rgba(255, 215, 0, 0.8)",t.lineWidth=3,t.beginPath(),t.arc(l,o,30,0,Math.PI*2),t.stroke(),t.beginPath(),t.moveTo(l-40,o),t.lineTo(l+40,o),t.moveTo(l,o-40),t.lineTo(l,o+40),t.stroke();const n=e.width/2-100,a=120,s=200,u=25;if(t.fillStyle="#fff",t.font="bold 18px Arial",t.textAlign="center",t.fillText(e.shotStage===1?"STEP 1: SET POWER":"STEP 2: SET ACCURACY",e.width/2,a-20),e.shotStage===1){t.fillStyle="rgba(0, 0, 0, 0.7)",t.fillRect(n-5,a-5,s+10,u+10),t.fillStyle="#333",t.fillRect(n,a,s,u),t.fillStyle="rgba(76, 175, 80, 0.4)",t.fillRect(n+s*.5,a,s*.5,u),t.fillStyle="rgba(255, 215, 0, 0.5)",t.fillRect(n+s*.75,a,s*.25,u);let d="#FF5722";e.shotPower>=75?d="#FFD700":e.shotPower>=50&&(d="#4CAF50"),t.fillStyle=d,t.fillRect(n,a,s*(e.shotPower/100),u),t.fillStyle="#fff",t.font="bold 14px Arial",t.textAlign="center",t.fillText("POWER",n+s/2,a-10),t.font="16px Arial",t.fillStyle="rgba(255, 255, 255, 0.9)",t.fillText("Click when in GOLD zone!",n+s/2,a+50)}else if(e.shotStage===2){t.fillStyle="#FFD700",t.font="bold 16px Arial",t.textAlign="center";let d="Power: ";e.lockedPower>=75?d+="PERFECT! ‚≠ê":e.lockedPower>=50?d+="Good":d+="Weak",t.fillText(d,e.width/2,a-40)}if(e.shotStage===2){const d=a;t.fillStyle="rgba(0, 0, 0, 0.7)",t.fillRect(n-5,d-5,s+10,u+10),t.fillStyle="#333",t.fillRect(n,d,s,u),t.fillStyle="rgba(76, 175, 80, 0.6)",t.fillRect(n+s*.4,d,s*.2,u),t.fillStyle="rgba(255, 255, 0, 0.4)",t.fillRect(n+s*.45,d,s*.1,u);const h=n+s*(e.shotAccuracy/100);t.fillStyle="#FF5722",t.fillRect(h-3,d-2,6,u+4),t.fillStyle="#fff",t.font="bold 14px Arial",t.fillText("ACCURACY",n+s/2,d-10),t.font="16px Arial",t.fillStyle="rgba(255, 255, 255, 0.9)",t.fillText("Click when PERFECT!",n+s/2,d+50);const g=Math.abs(e.shotAccuracy-50);let b="",f="";g<=10?(b="PERFECT! ‚≠ê",f="#FFD700"):g<=20?(b="Good",f="#4CAF50"):(b="Poor",f="#FF5722"),t.fillStyle=f,t.font="bold 18px Arial",t.fillText(b,n+s/2,d+70)}}function me(){const t=e.ctx;t.fillStyle="rgba(255, 255, 255, 0.7)",t.font="14px Arial",t.textAlign="left",/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)?t.fillText("MOBILE: Touch sides = Move | Tap = Jump/Shoot",10,20):t.fillText("CONTROLS: Arrow Keys/WASD = Move | SPACE = Jump | CLICK = Shoot | D = Defend",10,20),t.fillText("First to 21 wins! | 2pts (inside arc) | 3pts (outside arc) | 5pts (half-court)",10,40);const o=Math.floor(e.timeRemaining/60),n=Math.floor(e.timeRemaining%60),a=`${o}:${n.toString().padStart(2,"0")}`;t.font="bold 24px Arial",t.textAlign="center",t.fillStyle=e.timeRemaining<30?"#FF5722":"#fff",t.fillText(a,e.width/2,60)}function pe(){if(!/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent))return;const l=e.ctx,o=e.width,n=e.height;l.fillStyle="rgba(255, 255, 255, 0.05)",l.fillRect(0,0,o/3,n),l.fillRect(o*2/3,0,o/3,n),l.fillStyle="rgba(255, 255, 255, 0.2)",l.font="bold 40px Arial",l.textAlign="center",l.fillText("‚óÑ",o/6,n-50),l.fillText("TAP",o/2,n-50),l.fillText("‚ñ∫",o*5/6,n-50)}function he(){document.getElementById("restart-btn").addEventListener("click",z),document.getElementById("mute-btn").addEventListener("click",ge),S()}function S(){document.getElementById("level-number").textContent=`${e.score.player} - ${e.score.cpu}`}function T(t,l){const o=document.getElementById("message");o.textContent=t,o.classList.add("show"),l&&setTimeout(()=>M(),l)}function M(){document.getElementById("message").classList.remove("show")}function ge(){e.muted=!e.muted,document.getElementById("mute-btn").textContent=e.muted?"üîá":"üîä"}let _=null;function be(){return _||(_=new(window.AudioContext||window.webkitAudioContext)),_}function p(t){if(!e.muted)try{const l=be(),o=l.createOscillator(),n=l.createGain();o.connect(n),n.connect(l.destination);const a=l.currentTime;t==="jump"?(o.frequency.setValueAtTime(200,a),o.frequency.exponentialRampToValueAtTime(100,a+.1),n.gain.setValueAtTime(.08,a),n.gain.exponentialRampToValueAtTime(.01,a+.1),o.start(a),o.stop(a+.1)):t==="shoot"?(o.frequency.setValueAtTime(300,a),o.frequency.exponentialRampToValueAtTime(150,a+.15),n.gain.setValueAtTime(.1,a),n.gain.exponentialRampToValueAtTime(.01,a+.15),o.start(a),o.stop(a+.15)):t==="score"?(o.frequency.setValueAtTime(440,a),o.frequency.exponentialRampToValueAtTime(880,a+.2),n.gain.setValueAtTime(.12,a),n.gain.exponentialRampToValueAtTime(.01,a+.2),o.start(a),o.stop(a+.2)):t==="block"?(o.type="square",o.frequency.setValueAtTime(100,a),n.gain.setValueAtTime(.1,a),n.gain.exponentialRampToValueAtTime(.01,a+.1),o.start(a),o.stop(a+.1)):t==="pickup"&&(o.frequency.setValueAtTime(400,a),n.gain.setValueAtTime(.05,a),n.gain.exponentialRampToValueAtTime(.01,a+.05),o.start(a),o.stop(a+.05))}catch(l){console.warn("Audio error:",l)}}let m=!1,x=!1;function xe(){try{r=io({transports:["websocket","polling"],timeout:5e3}),r.on("connect",()=>{console.log("Connected to server"),document.getElementById("lobby-status").textContent="Connected! Searching for opponent..."}),r.on("connect_error",t=>{console.error("Connection error:",t),document.getElementById("lobby-status").textContent="Connection failed. Please check server."}),r.on("waitingForOpponent",()=>{document.getElementById("lobby-status").textContent="Searching for opponent..."})}catch(t){console.error("Socket initialization error:",t),document.getElementById("lobby-status").textContent="Connection failed."}r.on("matchFound",t=>{c.roomId=t.roomId,c.playerNumber=t.playerNumber,c.opponentId=t.opponentId,m=!1,x=!1,Te()}),r.on("opponentReadyState",t=>{x=t.ready,k(),m&&x&&C()}),r.on("bothReady",()=>{C()}),r.on("opponentLeftLobby",()=>{m=!1,x=!1,document.getElementById("lobby-status").textContent="Opponent left. Searching again...",K(),r&&r.connected&&r.emit("findMatch")}),r.on("opponentMove",t=>{y==="multiplayer"&&(e.cpu.x=t.x,e.cpu.y=t.y,e.cpu.vx=t.vx,e.cpu.vy=t.vy,e.cpu.isGrounded=t.isGrounded,e.cpu.defending=t.defending)}),r.on("ballSync",t=>{y==="multiplayer"&&c.playerNumber===2&&(e.ball.x=t.x,e.ball.y=t.y,e.ball.vx=t.vx,e.ball.vy=t.vy,e.ball.inAir=t.inAir,t.owner==="player"?e.ball.owner="cpu":t.owner==="cpu"?e.ball.owner="player":e.ball.owner=t.owner,t.shotFrom?e.ball.shotFrom={...t.shotFrom,shooter:t.shotFrom.shooter==="player"?"cpu":"player"}:e.ball.shotFrom=null)}),r.on("scoreUpdate",t=>{y==="multiplayer"&&(c.playerNumber===1?(e.score.player=t.score.player1,e.score.cpu=t.score.player2):(e.score.player=t.score.player2,e.score.cpu=t.score.player1),S())}),r.on("opponentDisconnected",()=>{T("Opponent disconnected",null),setTimeout(()=>{E()},2e3)}),r.on("opponentLeft",()=>{T("Opponent left the game",null),setTimeout(()=>{E()},2e3)}),r.on("ballPickupSync",t=>{y==="multiplayer"&&(c.playerNumber===2?t.owner==="player"?e.ball.owner="cpu":t.owner==="cpu"?e.ball.owner="player":e.ball.owner=t.owner:e.ball.owner=t.owner,p("pickup"))})}function K(){document.getElementById("main-menu").style.display="none",document.getElementById("ready-lobby").style.display="none",document.getElementById("game-container").style.display="none",document.getElementById("matchmaking-lobby").style.display="block"}function Te(){document.getElementById("main-menu").style.display="none",document.getElementById("matchmaking-lobby").style.display="none",document.getElementById("game-container").style.display="none",document.getElementById("ready-lobby").style.display="block",k();const t=document.getElementById("ready-btn");t.textContent="Ready!",t.classList.remove("is-ready")}function k(){const t=document.getElementById("your-ready-status"),l=document.getElementById("opponent-ready-status");m?(t.textContent="Ready!",t.classList.remove("not-ready"),t.classList.add("ready")):(t.textContent="Not Ready",t.classList.remove("ready"),t.classList.add("not-ready")),x?(l.textContent="Ready!",l.classList.remove("not-ready"),l.classList.add("ready")):(l.textContent="Not Ready",l.classList.remove("ready"),l.classList.add("not-ready"))}function ve(){m=!m;const t=document.getElementById("ready-btn");m?(t.textContent="Waiting...",t.classList.add("is-ready")):(t.textContent="Ready!",t.classList.remove("is-ready")),k(),r&&c.roomId&&r.emit("playerReady",{roomId:c.roomId,ready:m}),m&&x&&C()}function C(){const t=document.createElement("div");t.className="countdown-overlay",t.id="countdown-overlay",document.body.appendChild(t);let l=3;function o(){l>0?(t.innerHTML=`<div class="countdown-number">${l}</div>`,l--,setTimeout(o,1e3)):(t.innerHTML='<div class="countdown-number">GO!</div>',setTimeout(()=>{t.remove(),Oe()},500))}o()}function Oe(){y="multiplayer",document.getElementById("main-menu").style.display="none",document.getElementById("matchmaking-lobby").style.display="none",document.getElementById("ready-lobby").style.display="none",document.getElementById("game-container").style.display="block",j()}function we(){y="singleplayer",document.getElementById("main-menu").style.display="none",document.getElementById("matchmaking-lobby").style.display="none",document.getElementById("ready-lobby").style.display="none",document.getElementById("game-container").style.display="block",j()}function E(){y="singleplayer";const t=c.roomId;c={roomId:null,playerNumber:null,opponentId:null},m=!1,x=!1,document.getElementById("game-container").style.display="none",document.getElementById("matchmaking-lobby").style.display="none",document.getElementById("ready-lobby").style.display="none",document.getElementById("main-menu").style.display="block",document.getElementById("connection-status").textContent="";const l=document.getElementById("countdown-overlay");l&&l.remove(),r&&t&&r.emit("leaveRoom",{roomId:t})}function Ae(){r&&r.emit("cancelSearch"),E()}function Re(){r&&c.roomId&&r.emit("leaveLobby",{roomId:c.roomId}),E()}function Ie(){y==="multiplayer"&&r&&c.roomId&&r.emit("playerMove",{roomId:c.roomId,x:e.player.x,y:e.player.y,vx:e.player.vx,vy:e.player.vy,isGrounded:e.player.isGrounded,defending:e.player.defending})}function Q(){y==="multiplayer"&&r&&c.roomId&&r.emit("ballUpdate",{roomId:c.roomId,x:e.ball.x,y:e.ball.y,vx:e.ball.vx,vy:e.ball.vy,inAir:e.ball.inAir,owner:e.ball.owner,shotFrom:e.ball.shotFrom})}function Ee(t){y==="multiplayer"&&r&&c.roomId&&r.emit("playerScored",{roomId:c.roomId,scorer:c.playerNumber,points:t})}function Se(t){y==="multiplayer"&&r&&c.roomId&&r.emit("ballPickup",{roomId:c.roomId,owner:t})}window.addEventListener("DOMContentLoaded",()=>{console.log("DOM loaded, setting up menu...");const t=document.getElementById("vs-cpu-btn"),l=document.getElementById("multiplayer-btn"),o=document.getElementById("cancel-search-btn"),n=document.getElementById("ready-btn"),a=document.getElementById("leave-lobby-btn");t&&t.addEventListener("click",()=>{console.log("Single player clicked"),we()}),l&&l.addEventListener("click",()=>{console.log("Multiplayer clicked"),K(),document.getElementById("lobby-status").textContent="Connecting to server...",r||xe(),setTimeout(()=>{r&&r.connected?(document.getElementById("lobby-status").textContent="Searching for opponent...",r.emit("findMatch")):document.getElementById("lobby-status").textContent="Connection failed. Please try again."},500)}),o&&o.addEventListener("click",()=>{console.log("Cancel search clicked"),Ae()}),n&&n.addEventListener("click",()=>{console.log("Ready clicked"),ve()}),a&&a.addEventListener("click",()=>{console.log("Leave lobby clicked"),Re()})});
