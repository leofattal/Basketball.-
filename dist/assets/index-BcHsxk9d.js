(function(){const l=document.createElement("link").relList;if(l&&l.supports&&l.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))a(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const s of r.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&a(s)}).observe(document,{childList:!0,subtree:!0});function o(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function a(n){if(n.ep)return;n.ep=!0;const r=o(n);fetch(n.href,r)}})();let c=null,y="singleplayer",d={roomId:null,playerNumber:null,opponentId:null};const i={GRAVITY:1200,MOVE_SPEED:250,BALL_GRAVITY:800,PLAYER_WIDTH:30,PLAYER_HEIGHT:60,BALL_RADIUS:10,COURT_FLOOR_Y:500,HOOP_LEFT_X:100,HOOP_RIGHT_X:700,HOOP_Y:250,HOOP_RADIUS:35,BLOCK_RANGE:80,STEAL_RANGE:40,WIN_SCORE:21,GAME_TIME:300},T={PLAYING:"playing",GAME_OVER:"gameover"},e={state:T.PLAYING,score:{player:0,cpu:0},timeRemaining:i.GAME_TIME,player:{x:600,y:i.COURT_FLOOR_Y,vx:0,vy:0,width:i.PLAYER_WIDTH,height:i.PLAYER_HEIGHT,isGrounded:!0,hasJumped:!1,jumpTime:0,facingLeft:!0,defending:!1},cpu:{x:200,y:i.COURT_FLOOR_Y,vx:0,vy:0,width:i.PLAYER_WIDTH,height:i.PLAYER_HEIGHT,isGrounded:!0,hasJumped:!1,jumpTime:0,facingLeft:!1,defending:!1,nextAction:0},ball:{x:600,y:i.COURT_FLOOR_Y-20,vx:0,vy:0,owner:"player",inAir:!1,shotFrom:null},canvas:null,ctx:null,width:800,height:600,scale:1,keys:{},muted:!1,shotCharging:!1,shotStage:0,shotPower:0,lockedPower:0,shotAccuracy:0,accuracyDirection:1,timeScale:1};let V=!1,W=!1;function $(){if(V||(e.canvas=document.getElementById("game-canvas"),e.ctx=e.canvas.getContext("2d"),X(),window.addEventListener("resize",X),re(),ve(),V=!0),ae(),!W){let o=function(a){const n=l?(a-l)/1e3:0;l=a,ce(Math.min(n,.1)),pe(),requestAnimationFrame(o)};var t=o;W=!0;let l=0;requestAnimationFrame(o)}}function ae(){e.state=T.PLAYING,e.score={player:0,cpu:0},e.timeRemaining=i.GAME_TIME,e.shotCharging=!1,e.shotStage=0,e.shotPower=0,e.lockedPower=0,e.shotAccuracy=0,e.accuracyDirection=1,e.timeScale=1,B("player"),O(),S()}function X(){const l=e.canvas.parentElement.getBoundingClientRect(),o=window.devicePixelRatio||1;e.canvas.width=l.width*o,e.canvas.height=l.height*o,e.canvas.style.width=l.width+"px",e.canvas.style.height=l.height+"px",e.scale=l.width/e.width,e.ctx.scale(o,o)}const ie=()=>"ontouchstart"in window||navigator.maxTouchPoints>0;function re(){document.addEventListener("keydown",t=>{e.keys[t.key.toLowerCase()]=!0,t.key===" "&&e.player.isGrounded&&!e.player.hasJumped&&A(e.player),t.key.toLowerCase()==="d"&&(e.player.defending=!0),t.key.toLowerCase()==="r"&&Q()}),document.addEventListener("keyup",t=>{e.keys[t.key.toLowerCase()]=!1,t.key.toLowerCase()==="d"&&(e.player.defending=!1)}),e.canvas.addEventListener("mousedown",M),se()}function se(){const t=document.getElementById("dpad-left"),l=document.getElementById("dpad-right"),o=document.getElementById("btn-jump"),a=document.getElementById("btn-shoot"),n=document.getElementById("btn-defend");if(!t||!l||!o||!a||!n)return;const r=(s,u,m)=>{s.addEventListener("touchstart",f=>{f.preventDefault(),s.classList.add("active"),u()},{passive:!1}),s.addEventListener("touchend",f=>{f.preventDefault(),s.classList.remove("active"),m&&m()},{passive:!1}),s.addEventListener("touchcancel",f=>{s.classList.remove("active"),m&&m()}),s.addEventListener("mousedown",f=>{f.preventDefault(),s.classList.add("active"),u()}),s.addEventListener("mouseup",f=>{s.classList.remove("active"),m&&m()}),s.addEventListener("mouseleave",f=>{s.classList.remove("active"),m&&m()})};r(t,()=>{e.keys.arrowleft=!0},()=>{e.keys.arrowleft=!1}),r(l,()=>{e.keys.arrowright=!0},()=>{e.keys.arrowright=!1}),r(o,()=>{e.player.isGrounded&&!e.player.hasJumped&&A(e.player)},null),r(a,()=>{!e.player.isGrounded&&e.ball.owner==="player"&&M({preventDefault:()=>{}})},null),r(n,()=>{e.player.defending=!0},()=>{e.player.defending=!1}),e.canvas.addEventListener("touchstart",s=>{e.shotCharging&&e.shotStage>0&&(s.preventDefault(),M({preventDefault:()=>{}}))},{passive:!1})}function M(t){t.preventDefault(),!e.player.isGrounded&&e.ball.owner==="player"&&(e.shotStage===0?(e.shotCharging=!0,e.shotStage=1,e.shotPower=0,e.timeScale=0,g("jump")):e.shotStage===1?(e.lockedPower=e.shotPower,e.shotStage=2,e.shotAccuracy=50,g("jump")):e.shotStage===2&&(K(e.player),e.shotCharging=!1,e.shotStage=0,e.timeScale=1))}function A(t){t.isGrounded&&(t.vy=-500,t.isGrounded=!1,t.hasJumped=!0,t.jumpTime=0,g("jump"))}function K(t){if(e.ball.owner!==(t===e.player?"player":"cpu"))return;const l=t.jumpTime/.5,o=1-Math.abs(l-.5)*2,a=t===e.player?e.cpu:e.player;if(a.defending&&Math.abs(a.x-t.x)<i.BLOCK_RANGE&&Math.abs(a.y-t.y)<60&&Math.random()>.3){e.ball.vx=(Math.random()-.5)*200,e.ball.vy=-100,e.ball.owner=null,e.ball.inAir=!0,e.ball.shotFrom=null,g("block");return}let r;t===e.player?y==="multiplayer"&&d.playerNumber===2?r=i.HOOP_RIGHT_X:r=i.HOOP_LEFT_X:y==="multiplayer"&&d.playerNumber===2?r=i.HOOP_LEFT_X:r=i.HOOP_RIGHT_X;const s=i.HOOP_Y,u=r-t.x;s-(t.y-t.height/2);let m=.5;if(t===e.player&&e.shotCharging){const _=Math.abs(e.shotAccuracy-50);_<=10?m=1:_<=20?m=.8:m=.3-(_-20)/30*.3}else t===e.cpu&&(m=.7+Math.random()*.2);const f=o*.2+m*.8,b=Math.abs(t.x-r);let p=0;f>=.95?p=0:f>=.8?p=2:f>=.6?p=8:p=(1-f)*80;let w=1;t===e.player&&e.shotStage===2&&(e.lockedPower>=75?w=1:e.lockedPower>=50?w=.85+(e.lockedPower-50)/25*.15:w=.6+e.lockedPower/50*.25);const P=i.BALL_GRAVITY;let E;b<=150?E=120:b<350?E=180:E=250,E*=w;const G=t.y-t.height/2,H=Math.min(G,s)-E,D=G-H,te=Math.sqrt(2*D/P),le=s-H,oe=Math.sqrt(2*le/P),ne=te+oe;let I=u/ne,R=-Math.sqrt(2*P*D);const Y=(Math.random()-.5)*p*Math.PI/180,U=Math.atan2(R,I),N=Math.sqrt(I*I+R*R);I=Math.cos(U+Y)*N,R=Math.sin(U+Y)*N,e.ball.vx=I,e.ball.vy=R,e.ball.owner=null,e.ball.inAir=!0,e.ball.shotFrom={x:t.x,y:t.y,shooter:t===e.player?"player":"cpu",targetHoop:r},y==="multiplayer"&&ee(),g("shoot")}function Q(){e.score={player:0,cpu:0},e.timeRemaining=i.GAME_TIME,e.state=T.PLAYING,B("player"),O(),S()}function B(t){let l,o;y==="multiplayer"?d.playerNumber===1?(l=600,o=200):(l=200,o=600):(l=600,o=200),e.player.x=l,e.player.y=i.COURT_FLOOR_Y,e.player.vx=0,e.player.vy=0,e.player.isGrounded=!0,e.player.hasJumped=!1,e.player.defending=!1,e.cpu.x=o,e.cpu.y=i.COURT_FLOOR_Y,e.cpu.vx=0,e.cpu.vy=0,e.cpu.isGrounded=!0,e.cpu.hasJumped=!1,e.cpu.defending=!1,e.ball.owner=t==="player"?"cpu":"player",e.ball.inAir=!1,e.ball.vx=0,e.ball.vy=0,e.ball.owner==="player"?(e.ball.x=e.player.x,e.ball.y=e.player.y-20):(e.ball.x=e.cpu.x,e.ball.y=e.cpu.y-20)}function ce(t){if(t<=0||e.state===T.GAME_OVER)return;const l=t*e.timeScale;if(e.state===T.PLAYING&&e.timeScale>0&&(e.timeRemaining-=t,e.timeRemaining<=0)){e.timeRemaining=0,fe();return}de(l),ue(l),ye(l),me(),e.shotCharging&&(e.shotStage===1?(e.shotPower+=t*50,e.shotPower>=100&&(e.shotPower=0)):e.shotStage===2&&(e.shotAccuracy+=e.accuracyDirection*t*70,e.shotAccuracy>=100?(e.shotAccuracy=100,e.accuracyDirection=-1):e.shotAccuracy<=0&&(e.shotAccuracy=0,e.accuracyDirection=1)))}function de(t){const l=e.player;e.keys.arrowleft||e.keys.a?(l.vx=-250,l.facingLeft=!0):e.keys.arrowright||e.keys.d?(l.vx=i.MOVE_SPEED,l.facingLeft=!1):l.vx=0,l.isGrounded||(l.vy+=i.GRAVITY*t,l.jumpTime+=t),l.x+=l.vx*t,l.y+=l.vy*t,l.x=Math.max(50,Math.min(e.width-50,l.x)),l.y>=i.COURT_FLOOR_Y&&(l.y=i.COURT_FLOOR_Y,l.vy=0,l.isGrounded=!0,l.hasJumped=!1,l.jumpTime=0,e.shotCharging&&(e.shotCharging=!1,e.shotStage=0,e.timeScale=1)),Pe()}function ue(t){if(y==="multiplayer")return;const l=e.cpu;if(l.nextAction-=t,e.ball.owner==="cpu"){const o=i.HOOP_RIGHT_X-150;Math.abs(l.x-o)>20?(l.vx=l.x<o?i.MOVE_SPEED:-250,l.facingLeft=l.vx<0):(l.vx=0,l.isGrounded&&l.nextAction<=0?(A(l),l.nextAction=.3):!l.isGrounded&&l.jumpTime>.2&&l.jumpTime<.4&&K(l))}else e.ball.owner==="player"?(Math.abs(l.x-e.player.x)>50?(l.vx=l.x<e.player.x?i.MOVE_SPEED*.8:-250*.8,l.facingLeft=l.vx<0):(l.vx=0,l.defending=!e.player.isGrounded&&Math.random()>.5),l.isGrounded&&!e.player.isGrounded&&l.nextAction<=0&&Math.random()>.7&&(A(l),l.nextAction=1)):Math.abs(l.x-e.ball.x)>20?(l.vx=l.x<e.ball.x?i.MOVE_SPEED:-250,l.facingLeft=l.vx<0):l.vx=0;l.isGrounded||(l.vy+=i.GRAVITY*t,l.jumpTime+=t),l.x+=l.vx*t,l.y+=l.vy*t,l.x=Math.max(50,Math.min(e.width-50,l.x)),l.y>=i.COURT_FLOOR_Y&&(l.y=i.COURT_FLOOR_Y,l.vy=0,l.isGrounded=!0,l.hasJumped=!1,l.jumpTime=0)}function ye(t){const l=y!=="multiplayer"||d.playerNumber===1;if(e.ball.owner==="player")e.ball.x=e.player.x,e.ball.y=e.player.y-e.player.height/2-i.BALL_RADIUS-5,e.ball.vx=0,e.ball.vy=0;else if(e.ball.owner==="cpu")e.ball.x=e.cpu.x,e.ball.y=e.cpu.y-e.cpu.height/2-i.BALL_RADIUS-5,e.ball.vx=0,e.ball.vy=0;else if(e.ball.inAir)l&&(e.ball.vy+=i.BALL_GRAVITY*t,e.ball.x+=e.ball.vx*t,e.ball.y+=e.ball.vy*t,e.ball.y>=i.COURT_FLOOR_Y&&(e.ball.y=i.COURT_FLOOR_Y,e.ball.vy*=-.6,e.ball.vx*=.8,Math.abs(e.ball.vy)<20&&(e.ball.inAir=!1,e.ball.vy=0)),(e.ball.x<i.BALL_RADIUS||e.ball.x>e.width-i.BALL_RADIUS)&&(e.ball.vx*=-.7,e.ball.x=Math.max(i.BALL_RADIUS,Math.min(e.width-i.BALL_RADIUS,e.ball.x))),ee());else if(l){const o=Math.sqrt(Math.pow(e.ball.x-e.player.x,2)+Math.pow(e.ball.y-e.player.y,2)),a=Math.sqrt(Math.pow(e.ball.x-e.cpu.x,2)+Math.pow(e.ball.y-e.cpu.y,2));let n=null;o<i.STEAL_RANGE&&o<a?n="player":a<i.STEAL_RANGE&&a<=o&&(n="cpu"),n&&(e.ball.owner=n,g("pickup"),y==="multiplayer"&&Ce(n))}}function me(){const t={x:i.HOOP_LEFT_X,y:i.HOOP_Y},l={x:i.HOOP_RIGHT_X,y:i.HOOP_Y};if(!e.ball.inAir||e.ball.vy<=0||!e.ball.shotFrom)return;const o=Math.abs(e.ball.shotFrom.x-e.ball.shotFrom.targetHoop);let a=i.HOOP_RADIUS;o<=150?a=i.HOOP_RADIUS+20:o<350?a=i.HOOP_RADIUS+5:a=i.HOOP_RADIUS-5;const n=y==="multiplayer"&&d.playerNumber===2?l:t,r=y==="multiplayer"&&d.playerNumber===2?t:l;if(Math.abs(e.ball.x-n.x)<a&&Math.abs(e.ball.y-n.y)<30&&e.ball.shotFrom.shooter==="player"){const s=q(e.ball.shotFrom);e.ball.shotFrom=null,j("player",s)}if(e.ball.shotFrom&&Math.abs(e.ball.x-r.x)<a&&Math.abs(e.ball.y-r.y)<30&&e.ball.shotFrom.shooter==="cpu"){const s=q(e.ball.shotFrom);e.ball.shotFrom=null,j("cpu",s)}}function q(t){const l=Math.abs(t.x-t.targetHoop);return l>=350?5:l>150?3:2}function j(t,l){e.score[t]+=l,O(),g("score"),t==="player"&&_e(l);let o="";l===5?o="üî• 5 POINTS! Half-court shot!":l===3?o="üéØ 3-Pointer!":o="+2 Points";const a=t==="player"?o:`CPU Scores ${l} pts`;e.score[t]>=i.WIN_SCORE?(e.state=T.GAME_OVER,v(t==="player"?"YOU WIN! üèÜ":"CPU WINS!",null)):(v(a,1500),setTimeout(()=>{B(t),S()},1500))}function fe(){e.state=T.GAME_OVER,e.score.player>e.score.cpu?v("TIME'S UP! YOU WIN! üèÜ",null):e.score.cpu>e.score.player?v("TIME'S UP! CPU WINS!",null):v("TIME'S UP! TIE GAME! ü§ù",null)}function pe(){const t=e.ctx;t.fillStyle="#16213e",t.fillRect(0,0,e.width,e.height),he(),J(i.HOOP_LEFT_X,i.HOOP_Y),J(i.HOOP_RIGHT_X,i.HOOP_Y);let l,o;y==="multiplayer"?d.playerNumber===1?(l="#4CAF50",o="#e94560"):(l="#e94560",o="#4CAF50"):(l="#4CAF50",o="#e94560"),z(e.cpu,o),z(e.player,l),ge(),e.shotCharging&&(t.fillStyle="rgba(0, 50, 100, 0.15)",t.fillRect(0,0,e.width,e.height),be()),xe()}function he(){const t=e.ctx;t.fillStyle="#d4a574",t.fillRect(0,i.COURT_FLOOR_Y,e.width,e.height-i.COURT_FLOOR_Y),t.strokeStyle="#ffffff",t.lineWidth=3,t.beginPath(),t.moveTo(e.width/2,0),t.lineTo(e.width/2,i.COURT_FLOOR_Y),t.stroke(),t.strokeStyle="rgba(255, 255, 255, 0.3)",t.lineWidth=2,t.beginPath(),t.arc(i.HOOP_LEFT_X,i.COURT_FLOOR_Y,150,0,Math.PI,!0),t.stroke(),t.beginPath(),t.arc(i.HOOP_RIGHT_X,i.COURT_FLOOR_Y,150,0,Math.PI,!0),t.stroke()}function J(t,l,o){const a=e.ctx;a.fillStyle="rgba(255, 255, 255, 0.8)",a.fillRect(t-3,l-60,6,80),a.strokeStyle="#ff6b35",a.lineWidth=4,a.beginPath(),a.arc(t,l,i.HOOP_RADIUS,0,Math.PI),a.stroke(),a.strokeStyle="rgba(255, 255, 255, 0.4)",a.lineWidth=1;for(let n=-1;n<=1;n++)a.beginPath(),a.moveTo(t+n*20,l),a.lineTo(t+n*15,l+40),a.stroke()}function z(t,l){const o=e.ctx,a=t.x,n=t.y-t.height;o.fillStyle=l,o.fillRect(a-t.width/2,n,t.width,t.height),o.beginPath(),o.arc(a,n,12,0,Math.PI*2),o.fill(),t.defending&&(o.strokeStyle=l,o.lineWidth=4,o.beginPath(),o.moveTo(a-t.width/2,n+15),o.lineTo(a-t.width/2-20,n-10),o.stroke(),o.beginPath(),o.moveTo(a+t.width/2,n+15),o.lineTo(a+t.width/2+20,n-10),o.stroke()),o.strokeStyle="rgba(0, 0, 0, 0.3)",o.lineWidth=2,o.strokeRect(a-t.width/2,n,t.width,t.height)}function ge(){const t=e.ctx,l=t.createRadialGradient(e.ball.x-3,e.ball.y-3,2,e.ball.x,e.ball.y,i.BALL_RADIUS);l.addColorStop(0,"#ff8c42"),l.addColorStop(1,"#ff6b35"),t.fillStyle=l,t.beginPath(),t.arc(e.ball.x,e.ball.y,i.BALL_RADIUS,0,Math.PI*2),t.fill(),t.strokeStyle="#d64933",t.lineWidth=2,t.stroke()}function be(){const t=e.ctx,l=y==="multiplayer"&&d.playerNumber===2?i.HOOP_RIGHT_X:i.HOOP_LEFT_X,o=i.HOOP_Y;t.strokeStyle="rgba(255, 215, 0, 0.6)",t.lineWidth=3,t.setLineDash([10,10]),t.beginPath(),t.moveTo(e.player.x,e.player.y-e.player.height/2),t.lineTo(l,o),t.stroke(),t.setLineDash([]),t.strokeStyle="rgba(255, 215, 0, 0.8)",t.lineWidth=3,t.beginPath(),t.arc(l,o,30,0,Math.PI*2),t.stroke(),t.beginPath(),t.moveTo(l-40,o),t.lineTo(l+40,o),t.moveTo(l,o-40),t.lineTo(l,o+40),t.stroke();const a=e.width/2-100,n=120,r=200,s=25;if(t.fillStyle="#fff",t.font="bold 18px Arial",t.textAlign="center",t.fillText(e.shotStage===1?"STEP 1: SET POWER":"STEP 2: SET ACCURACY",e.width/2,n-20),e.shotStage===1){t.fillStyle="rgba(0, 0, 0, 0.7)",t.fillRect(a-5,n-5,r+10,s+10),t.fillStyle="#333",t.fillRect(a,n,r,s),t.fillStyle="rgba(76, 175, 80, 0.4)",t.fillRect(a+r*.5,n,r*.5,s),t.fillStyle="rgba(255, 215, 0, 0.5)",t.fillRect(a+r*.75,n,r*.25,s);let u="#FF5722";e.shotPower>=75?u="#FFD700":e.shotPower>=50&&(u="#4CAF50"),t.fillStyle=u,t.fillRect(a,n,r*(e.shotPower/100),s),t.fillStyle="#fff",t.font="bold 14px Arial",t.textAlign="center",t.fillText("POWER",a+r/2,n-10),t.font="16px Arial",t.fillStyle="rgba(255, 255, 255, 0.9)",t.fillText("Click when in GOLD zone!",a+r/2,n+50)}else if(e.shotStage===2){t.fillStyle="#FFD700",t.font="bold 16px Arial",t.textAlign="center";let u="Power: ";e.lockedPower>=75?u+="PERFECT! ‚≠ê":e.lockedPower>=50?u+="Good":u+="Weak",t.fillText(u,e.width/2,n-40)}if(e.shotStage===2){const u=n;t.fillStyle="rgba(0, 0, 0, 0.7)",t.fillRect(a-5,u-5,r+10,s+10),t.fillStyle="#333",t.fillRect(a,u,r,s),t.fillStyle="rgba(76, 175, 80, 0.6)",t.fillRect(a+r*.4,u,r*.2,s),t.fillStyle="rgba(255, 255, 0, 0.4)",t.fillRect(a+r*.45,u,r*.1,s);const m=a+r*(e.shotAccuracy/100);t.fillStyle="#FF5722",t.fillRect(m-3,u-2,6,s+4),t.fillStyle="#fff",t.font="bold 14px Arial",t.fillText("ACCURACY",a+r/2,u-10),t.font="16px Arial",t.fillStyle="rgba(255, 255, 255, 0.9)",t.fillText("Click when PERFECT!",a+r/2,u+50);const f=Math.abs(e.shotAccuracy-50);let b="",p="";f<=10?(b="PERFECT! ‚≠ê",p="#FFD700"):f<=20?(b="Good",p="#4CAF50"):(b="Poor",p="#FF5722"),t.fillStyle=p,t.font="bold 18px Arial",t.fillText(b,a+r/2,u+70)}}function xe(){const t=e.ctx;t.fillStyle="rgba(255, 255, 255, 0.7)",t.font="14px Arial",t.textAlign="left",ie()||t.fillText("CONTROLS: Arrow Keys/WASD = Move | SPACE = Jump | CLICK = Shoot | D = Defend",10,20),t.fillText("First to 21 wins! | 2pts (inside arc) | 3pts (outside arc) | 5pts (half-court)",10,40);const l=Math.floor(e.timeRemaining/60),o=Math.floor(e.timeRemaining%60),a=`${l}:${o.toString().padStart(2,"0")}`;t.font="bold 24px Arial",t.textAlign="center",t.fillStyle=e.timeRemaining<30?"#FF5722":"#fff",t.fillText(a,e.width/2,60)}function ve(){document.getElementById("restart-btn").addEventListener("click",Q),document.getElementById("mute-btn").addEventListener("click",Te),O()}function O(){document.getElementById("level-number").textContent=`${e.score.player} - ${e.score.cpu}`}function v(t,l){const o=document.getElementById("message");o.textContent=t,o.classList.add("show"),l&&setTimeout(()=>S(),l)}function S(){document.getElementById("message").classList.remove("show")}function Te(){e.muted=!e.muted,document.getElementById("mute-btn").textContent=e.muted?"üîá":"üîä"}let C=null;function Ee(){return C||(C=new(window.AudioContext||window.webkitAudioContext)),C}function g(t){if(!e.muted)try{const l=Ee(),o=l.createOscillator(),a=l.createGain();o.connect(a),a.connect(l.destination);const n=l.currentTime;t==="jump"?(o.frequency.setValueAtTime(200,n),o.frequency.exponentialRampToValueAtTime(100,n+.1),a.gain.setValueAtTime(.08,n),a.gain.exponentialRampToValueAtTime(.01,n+.1),o.start(n),o.stop(n+.1)):t==="shoot"?(o.frequency.setValueAtTime(300,n),o.frequency.exponentialRampToValueAtTime(150,n+.15),a.gain.setValueAtTime(.1,n),a.gain.exponentialRampToValueAtTime(.01,n+.15),o.start(n),o.stop(n+.15)):t==="score"?(o.frequency.setValueAtTime(440,n),o.frequency.exponentialRampToValueAtTime(880,n+.2),a.gain.setValueAtTime(.12,n),a.gain.exponentialRampToValueAtTime(.01,n+.2),o.start(n),o.stop(n+.2)):t==="block"?(o.type="square",o.frequency.setValueAtTime(100,n),a.gain.setValueAtTime(.1,n),a.gain.exponentialRampToValueAtTime(.01,n+.1),o.start(n),o.stop(n+.1)):t==="pickup"&&(o.frequency.setValueAtTime(400,n),a.gain.setValueAtTime(.05,n),a.gain.exponentialRampToValueAtTime(.01,n+.05),o.start(n),o.stop(n+.05))}catch(l){console.warn("Audio error:",l)}}let h=!1,x=!1;function Ie(){try{c=io({transports:["websocket","polling"],timeout:5e3}),c.on("connect",()=>{console.log("Connected to server"),document.getElementById("lobby-status").textContent="Connected! Searching for opponent..."}),c.on("connect_error",t=>{console.error("Connection error:",t),document.getElementById("lobby-status").textContent="Connection failed. Please check server."}),c.on("waitingForOpponent",()=>{document.getElementById("lobby-status").textContent="Searching for opponent..."})}catch(t){console.error("Socket initialization error:",t),document.getElementById("lobby-status").textContent="Connection failed."}c.on("matchFound",t=>{d.roomId=t.roomId,d.playerNumber=t.playerNumber,d.opponentId=t.opponentId,h=!1,x=!1,Re()}),c.on("opponentReadyState",t=>{x=t.ready,F(),h&&x&&k()}),c.on("bothReady",()=>{k()}),c.on("opponentLeftLobby",()=>{h=!1,x=!1,document.getElementById("lobby-status").textContent="Opponent left. Searching again...",Z(),c&&c.connected&&c.emit("findMatch")}),c.on("opponentMove",t=>{y==="multiplayer"&&(e.cpu.x=t.x,e.cpu.y=t.y,e.cpu.vx=t.vx,e.cpu.vy=t.vy,e.cpu.isGrounded=t.isGrounded,e.cpu.defending=t.defending)}),c.on("ballSync",t=>{y==="multiplayer"&&d.playerNumber===2&&(e.ball.x=t.x,e.ball.y=t.y,e.ball.vx=t.vx,e.ball.vy=t.vy,e.ball.inAir=t.inAir,t.owner==="player"?e.ball.owner="cpu":t.owner==="cpu"?e.ball.owner="player":e.ball.owner=t.owner,t.shotFrom?e.ball.shotFrom={...t.shotFrom,shooter:t.shotFrom.shooter==="player"?"cpu":"player"}:e.ball.shotFrom=null)}),c.on("scoreUpdate",t=>{y==="multiplayer"&&(d.playerNumber===1?(e.score.player=t.score.player1,e.score.cpu=t.score.player2):(e.score.player=t.score.player2,e.score.cpu=t.score.player1),O())}),c.on("opponentDisconnected",()=>{v("Opponent disconnected",null),setTimeout(()=>{L()},2e3)}),c.on("opponentLeft",()=>{v("Opponent left the game",null),setTimeout(()=>{L()},2e3)}),c.on("ballPickupSync",t=>{y==="multiplayer"&&(d.playerNumber===2?t.owner==="player"?e.ball.owner="cpu":t.owner==="cpu"?e.ball.owner="player":e.ball.owner=t.owner:e.ball.owner=t.owner,g("pickup"))})}function Z(){document.getElementById("main-menu").style.display="none",document.getElementById("ready-lobby").style.display="none",document.getElementById("game-container").style.display="none",document.getElementById("matchmaking-lobby").style.display="block"}function Re(){document.getElementById("main-menu").style.display="none",document.getElementById("matchmaking-lobby").style.display="none",document.getElementById("game-container").style.display="none",document.getElementById("ready-lobby").style.display="block",F();const t=document.getElementById("ready-btn");t.textContent="Ready!",t.classList.remove("is-ready")}function F(){const t=document.getElementById("your-ready-status"),l=document.getElementById("opponent-ready-status");h?(t.textContent="Ready!",t.classList.remove("not-ready"),t.classList.add("ready")):(t.textContent="Not Ready",t.classList.remove("ready"),t.classList.add("not-ready")),x?(l.textContent="Ready!",l.classList.remove("not-ready"),l.classList.add("ready")):(l.textContent="Not Ready",l.classList.remove("ready"),l.classList.add("not-ready"))}function Oe(){h=!h;const t=document.getElementById("ready-btn");h?(t.textContent="Waiting...",t.classList.add("is-ready")):(t.textContent="Ready!",t.classList.remove("is-ready")),F(),c&&d.roomId&&c.emit("playerReady",{roomId:d.roomId,ready:h}),h&&x&&k()}function k(){const t=document.createElement("div");t.className="countdown-overlay",t.id="countdown-overlay",document.body.appendChild(t);let l=3;function o(){l>0?(t.innerHTML=`<div class="countdown-number">${l}</div>`,l--,setTimeout(o,1e3)):(t.innerHTML='<div class="countdown-number">GO!</div>',setTimeout(()=>{t.remove(),we()},500))}o()}function we(){y="multiplayer",document.getElementById("main-menu").style.display="none",document.getElementById("matchmaking-lobby").style.display="none",document.getElementById("ready-lobby").style.display="none",document.getElementById("game-container").style.display="block",$()}function Ae(){y="singleplayer",document.getElementById("main-menu").style.display="none",document.getElementById("matchmaking-lobby").style.display="none",document.getElementById("ready-lobby").style.display="none",document.getElementById("game-container").style.display="block",$()}function L(){y="singleplayer";const t=d.roomId;d={roomId:null,playerNumber:null,opponentId:null},h=!1,x=!1,document.getElementById("game-container").style.display="none",document.getElementById("matchmaking-lobby").style.display="none",document.getElementById("ready-lobby").style.display="none",document.getElementById("main-menu").style.display="block",document.getElementById("connection-status").textContent="";const l=document.getElementById("countdown-overlay");l&&l.remove(),c&&t&&c.emit("leaveRoom",{roomId:t})}function Le(){c&&c.emit("cancelSearch"),L()}function Se(){c&&d.roomId&&c.emit("leaveLobby",{roomId:d.roomId}),L()}function Pe(){y==="multiplayer"&&c&&d.roomId&&c.emit("playerMove",{roomId:d.roomId,x:e.player.x,y:e.player.y,vx:e.player.vx,vy:e.player.vy,isGrounded:e.player.isGrounded,defending:e.player.defending})}function ee(){y==="multiplayer"&&c&&d.roomId&&c.emit("ballUpdate",{roomId:d.roomId,x:e.ball.x,y:e.ball.y,vx:e.ball.vx,vy:e.ball.vy,inAir:e.ball.inAir,owner:e.ball.owner,shotFrom:e.ball.shotFrom})}function _e(t){y==="multiplayer"&&c&&d.roomId&&c.emit("playerScored",{roomId:d.roomId,scorer:d.playerNumber,points:t})}function Ce(t){y==="multiplayer"&&c&&d.roomId&&c.emit("ballPickup",{roomId:d.roomId,owner:t})}window.addEventListener("DOMContentLoaded",()=>{console.log("DOM loaded, setting up menu...");const t=document.getElementById("vs-cpu-btn"),l=document.getElementById("multiplayer-btn"),o=document.getElementById("cancel-search-btn"),a=document.getElementById("ready-btn"),n=document.getElementById("leave-lobby-btn");t&&t.addEventListener("click",()=>{console.log("Single player clicked"),Ae()}),l&&l.addEventListener("click",()=>{console.log("Multiplayer clicked"),Z(),document.getElementById("lobby-status").textContent="Connecting to server...",c||Ie(),setTimeout(()=>{c&&c.connected?(document.getElementById("lobby-status").textContent="Searching for opponent...",c.emit("findMatch")):document.getElementById("lobby-status").textContent="Connection failed. Please try again."},500)}),o&&o.addEventListener("click",()=>{console.log("Cancel search clicked"),Le()}),a&&a.addEventListener("click",()=>{console.log("Ready clicked"),Oe()}),n&&n.addEventListener("click",()=>{console.log("Leave lobby clicked"),Se()})});
