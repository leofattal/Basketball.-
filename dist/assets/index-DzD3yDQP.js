(function(){const l=document.createElement("link").relList;if(l&&l.supports&&l.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))a(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const s of r.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&a(s)}).observe(document,{childList:!0,subtree:!0});function o(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function a(n){if(n.ep)return;n.ep=!0;const r=o(n);fetch(n.href,r)}})();let c=null,f="singleplayer",u={roomId:null,playerNumber:null,opponentId:null};const i={GRAVITY:1200,MOVE_SPEED:250,BALL_GRAVITY:800,PLAYER_WIDTH:30,PLAYER_HEIGHT:60,BALL_RADIUS:10,COURT_FLOOR_Y:500,HOOP_LEFT_X:100,HOOP_RIGHT_X:700,HOOP_Y:250,HOOP_RADIUS:35,BLOCK_RANGE:80,STEAL_RANGE:40,WIN_SCORE:21,GAME_TIME:300,POWERUP_SPAWN_INTERVAL:8,POWERUP_DURATION:5,POWERUP_SIZE:20,POWERUP_PICKUP_RANGE:40},w={PLAYING:"playing",GAME_OVER:"gameover"},e={state:w.PLAYING,score:{player:0,cpu:0},timeRemaining:i.GAME_TIME,player:{x:600,y:i.COURT_FLOOR_Y,vx:0,vy:0,width:i.PLAYER_WIDTH,height:i.PLAYER_HEIGHT,isGrounded:!0,hasJumped:!1,jumpTime:0,facingLeft:!0,defending:!1},cpu:{x:200,y:i.COURT_FLOOR_Y,vx:0,vy:0,width:i.PLAYER_WIDTH,height:i.PLAYER_HEIGHT,isGrounded:!0,hasJumped:!1,jumpTime:0,facingLeft:!1,defending:!1,nextAction:0},ball:{x:600,y:i.COURT_FLOOR_Y-20,vx:0,vy:0,owner:"player",inAir:!1,shotFrom:null},canvas:null,ctx:null,width:800,height:600,scale:1,keys:{},muted:!1,shotCharging:!1,shotStage:0,shotPower:0,lockedPower:0,shotAccuracy:0,accuracyDirection:1,timeScale:1,powerups:[],powerupTimer:0,playerEffects:{speed:0,highJump:0},cpuEffects:{speed:0,highJump:0}};let V=!1,J=!1;function Q(){if(V||(e.canvas=document.getElementById("game-canvas"),e.ctx=e.canvas.getContext("2d"),q(),window.addEventListener("resize",q),ce(),Ie(),V=!0),re(),!J){let o=function(a){const n=l?(a-l)/1e3:0;l=a,pe(Math.min(n,.1)),xe(),requestAnimationFrame(o)};var t=o;J=!0;let l=0;requestAnimationFrame(o)}}function re(){e.state=w.PLAYING,e.score={player:0,cpu:0},e.timeRemaining=i.GAME_TIME,e.shotCharging=!1,e.shotStage=0,e.shotPower=0,e.lockedPower=0,e.shotAccuracy=0,e.accuracyDirection=1,e.timeScale=1,e.powerups=[],e.powerupTimer=i.POWERUP_SPAWN_INTERVAL,e.playerEffects={speed:0,highJump:0},e.cpuEffects={speed:0,highJump:0},B("player"),T(),S()}function q(){const l=e.canvas.parentElement.getBoundingClientRect(),o=window.devicePixelRatio||1;e.canvas.width=l.width*o,e.canvas.height=l.height*o,e.canvas.style.width=l.width+"px",e.canvas.style.height=l.height+"px",e.scale=l.width/e.width,e.ctx.scale(o,o)}const se=()=>"ontouchstart"in window||navigator.maxTouchPoints>0;function ce(){document.addEventListener("keydown",t=>{e.keys[t.key.toLowerCase()]=!0,t.key===" "&&e.player.isGrounded&&!e.player.hasJumped&&A(e.player),t.key.toLowerCase()==="d"&&(e.player.defending=!0),t.key.toLowerCase()==="r"&&ee()}),document.addEventListener("keyup",t=>{e.keys[t.key.toLowerCase()]=!1,t.key.toLowerCase()==="d"&&(e.player.defending=!1)}),e.canvas.addEventListener("mousedown",C),ue()}function ue(){const t=document.getElementById("dpad-left"),l=document.getElementById("dpad-right"),o=document.getElementById("btn-jump"),a=document.getElementById("btn-shoot"),n=document.getElementById("btn-defend");if(!t||!l||!o||!a||!n)return;const r=(s,d,p)=>{s.addEventListener("touchstart",y=>{y.preventDefault(),s.classList.add("active"),d()},{passive:!1}),s.addEventListener("touchend",y=>{y.preventDefault(),s.classList.remove("active"),p&&p()},{passive:!1}),s.addEventListener("touchcancel",y=>{s.classList.remove("active"),p&&p()}),s.addEventListener("mousedown",y=>{y.preventDefault(),s.classList.add("active"),d()}),s.addEventListener("mouseup",y=>{s.classList.remove("active"),p&&p()}),s.addEventListener("mouseleave",y=>{s.classList.remove("active"),p&&p()})};r(t,()=>{e.keys.arrowleft=!0},()=>{e.keys.arrowleft=!1}),r(l,()=>{e.keys.arrowright=!0},()=>{e.keys.arrowright=!1}),r(o,()=>{e.player.isGrounded&&!e.player.hasJumped&&A(e.player)},null),r(a,()=>{!e.player.isGrounded&&e.ball.owner==="player"&&C({preventDefault:()=>{}})},null),r(n,()=>{e.player.defending=!0},()=>{e.player.defending=!1}),e.canvas.addEventListener("touchstart",s=>{e.shotCharging&&e.shotStage>0&&(s.preventDefault(),C({preventDefault:()=>{}}))},{passive:!1})}function C(t){t.preventDefault(),!e.player.isGrounded&&e.ball.owner==="player"&&(e.shotStage===0?(e.shotCharging=!0,e.shotStage=1,e.shotPower=0,e.timeScale=0,g("jump")):e.shotStage===1?(e.lockedPower=e.shotPower,e.shotStage=2,e.shotAccuracy=50,g("jump")):e.shotStage===2&&(Z(e.player),e.shotCharging=!1,e.shotStage=0,e.timeScale=1))}function A(t){if(t.isGrounded){const o=(t===e.player?e.playerEffects:e.cpuEffects).highJump>0?1.6:1;t.vy=-500*o,t.isGrounded=!1,t.hasJumped=!0,t.jumpTime=0,g("jump")}}function Z(t){if(e.ball.owner!==(t===e.player?"player":"cpu"))return;const l=t.jumpTime/.5,o=1-Math.abs(l-.5)*2,a=t===e.player?e.cpu:e.player;if(a.defending&&Math.abs(a.x-t.x)<i.BLOCK_RANGE&&Math.abs(a.y-t.y)<60&&Math.random()>.3){e.ball.vx=(Math.random()-.5)*200,e.ball.vy=-100,e.ball.owner=null,e.ball.inAir=!0,e.ball.shotFrom=null,g("block");return}let r;t===e.player?f==="multiplayer"&&u.playerNumber===2?r=i.HOOP_RIGHT_X:r=i.HOOP_LEFT_X:f==="multiplayer"&&u.playerNumber===2?r=i.HOOP_LEFT_X:r=i.HOOP_RIGHT_X;const s=i.HOOP_Y,d=r-t.x;s-(t.y-t.height/2);let p=.5;if(t===e.player&&e.shotCharging){const _=Math.abs(e.shotAccuracy-50);_<=10?p=1:_<=20?p=.8:p=.3-(_-20)/30*.3}else t===e.cpu&&(p=.7+Math.random()*.2);const y=o*.2+p*.8,b=Math.abs(t.x-r);let m=0;y>=.95?m=0:y>=.8?m=2:y>=.6?m=8:m=(1-y)*80;let I=1;t===e.player&&e.shotStage===2&&(e.lockedPower>=75?I=1:e.lockedPower>=50?I=.85+(e.lockedPower-50)/25*.15:I=.6+e.lockedPower/50*.25);const L=i.BALL_GRAVITY;let P;b<=150?P=120:b<350?P=180:P=250,P*=I;const H=t.y-t.height/2,U=Math.min(H,s)-P,D=H-U,oe=Math.sqrt(2*D/L),ne=s-U,ae=Math.sqrt(2*ne/L),ie=oe+ae;let v=d/ie,R=-Math.sqrt(2*L*D);const Y=(Math.random()-.5)*m*Math.PI/180,N=Math.atan2(R,v),W=Math.sqrt(v*v+R*R);v=Math.cos(N+Y)*W,R=Math.sin(N+Y)*W,e.ball.vx=v,e.ball.vy=R,e.ball.owner=null,e.ball.inAir=!0,e.ball.shotFrom={x:t.x,y:t.y,shooter:t===e.player?"player":"cpu",targetHoop:r},f==="multiplayer"&&le(),g("shoot")}function ee(){e.score={player:0,cpu:0},e.timeRemaining=i.GAME_TIME,e.state=w.PLAYING,B("player"),T(),S()}function B(t){let l,o;f==="multiplayer"?u.playerNumber===1?(l=600,o=200):(l=200,o=600):(l=600,o=200),e.player.x=l,e.player.y=i.COURT_FLOOR_Y,e.player.vx=0,e.player.vy=0,e.player.isGrounded=!0,e.player.hasJumped=!1,e.player.defending=!1,e.cpu.x=o,e.cpu.y=i.COURT_FLOOR_Y,e.cpu.vx=0,e.cpu.vy=0,e.cpu.isGrounded=!0,e.cpu.hasJumped=!1,e.cpu.defending=!1,e.ball.owner=t==="player"?"cpu":"player",e.ball.inAir=!1,e.ball.vx=0,e.ball.vy=0,e.ball.owner==="player"?(e.ball.x=e.player.x,e.ball.y=e.player.y-20):(e.ball.x=e.cpu.x,e.ball.y=e.cpu.y-20)}const k=[{id:"speed",label:"SPEED",color:"#00E5FF",icon:"‚ö°"},{id:"highJump",label:"HIGH JUMP",color:"#76FF03",icon:"ü¶ò"}];function de(){const t=k[Math.floor(Math.random()*k.length)],l=200+Math.random()*400,o=i.COURT_FLOOR_Y-30-Math.random()*100;e.powerups.push({x:l,y:o,type:t.id,bobOffset:Math.random()*Math.PI*2,age:0})}function fe(t){if(!(t<=0)){e.playerEffects.speed>0&&(e.playerEffects.speed-=t),e.playerEffects.highJump>0&&(e.playerEffects.highJump-=t),e.cpuEffects.speed>0&&(e.cpuEffects.speed-=t),e.cpuEffects.highJump>0&&(e.cpuEffects.highJump-=t),e.powerupTimer-=t,e.powerupTimer<=0&&e.powerups.length<2&&(de(),e.powerupTimer=i.POWERUP_SPAWN_INTERVAL);for(const l of e.powerups)l.age+=t;for(let l=e.powerups.length-1;l>=0;l--){const o=e.powerups[l],a=Math.sqrt(Math.pow(o.x-e.player.x,2)+Math.pow(o.y-e.player.y,2)),n=Math.sqrt(Math.pow(o.x-e.cpu.x,2)+Math.pow(o.y-e.cpu.y,2));a<i.POWERUP_PICKUP_RANGE?(e.playerEffects[o.type]=i.POWERUP_DURATION,e.powerups.splice(l,1),g("pickup")):n<i.POWERUP_PICKUP_RANGE&&f!=="multiplayer"&&(e.cpuEffects[o.type]=i.POWERUP_DURATION,e.powerups.splice(l,1))}}}function pe(t){if(t<=0||e.state===w.GAME_OVER)return;const l=t*e.timeScale;if(e.state===w.PLAYING&&e.timeScale>0&&(e.timeRemaining-=t,e.timeRemaining<=0)){e.timeRemaining=0,be();return}fe(l),ye(l),me(l),he(l),ge(),e.shotCharging&&(e.shotStage===1?(e.shotPower+=t*50,e.shotPower>=100&&(e.shotPower=0)):e.shotStage===2&&(e.shotAccuracy+=e.accuracyDirection*t*70,e.shotAccuracy>=100?(e.shotAccuracy=100,e.accuracyDirection=-1):e.shotAccuracy<=0&&(e.shotAccuracy=0,e.accuracyDirection=1)))}function ye(t){const l=e.player,o=e.playerEffects.speed>0?1.8:1;e.keys.arrowleft||e.keys.a?(l.vx=-250*o,l.facingLeft=!0):e.keys.arrowright||e.keys.d?(l.vx=i.MOVE_SPEED*o,l.facingLeft=!1):l.vx=0,l.isGrounded||(l.vy+=i.GRAVITY*t,l.jumpTime+=t),l.x+=l.vx*t,l.y+=l.vy*t,l.x=Math.max(50,Math.min(e.width-50,l.x)),l.y>=i.COURT_FLOOR_Y&&(l.y=i.COURT_FLOOR_Y,l.vy=0,l.isGrounded=!0,l.hasJumped=!1,l.jumpTime=0,e.shotCharging&&(e.shotCharging=!1,e.shotStage=0,e.timeScale=1)),Be()}function me(t){if(f==="multiplayer")return;const l=e.cpu,o=e.cpuEffects.speed>0?1.8:1;if(l.nextAction-=t,e.ball.owner==="cpu"){const a=i.HOOP_RIGHT_X-150;Math.abs(l.x-a)>20?(l.vx=(l.x<a?i.MOVE_SPEED:-250)*o,l.facingLeft=l.vx<0):(l.vx=0,l.isGrounded&&l.nextAction<=0?(A(l),l.nextAction=.3):!l.isGrounded&&l.jumpTime>.2&&l.jumpTime<.4&&Z(l))}else e.ball.owner==="player"?(Math.abs(l.x-e.player.x)>50?(l.vx=(l.x<e.player.x?i.MOVE_SPEED*.8:-250*.8)*o,l.facingLeft=l.vx<0):(l.vx=0,l.defending=!e.player.isGrounded&&Math.random()>.5),l.isGrounded&&!e.player.isGrounded&&l.nextAction<=0&&Math.random()>.7&&(A(l),l.nextAction=1)):Math.abs(l.x-e.ball.x)>20?(l.vx=(l.x<e.ball.x?i.MOVE_SPEED:-250)*o,l.facingLeft=l.vx<0):l.vx=0;l.isGrounded||(l.vy+=i.GRAVITY*t,l.jumpTime+=t),l.x+=l.vx*t,l.y+=l.vy*t,l.x=Math.max(50,Math.min(e.width-50,l.x)),l.y>=i.COURT_FLOOR_Y&&(l.y=i.COURT_FLOOR_Y,l.vy=0,l.isGrounded=!0,l.hasJumped=!1,l.jumpTime=0)}function he(t){const l=f!=="multiplayer"||u.playerNumber===1;if(e.ball.owner==="player")e.ball.x=e.player.x,e.ball.y=e.player.y-e.player.height/2-i.BALL_RADIUS-5,e.ball.vx=0,e.ball.vy=0;else if(e.ball.owner==="cpu")e.ball.x=e.cpu.x,e.ball.y=e.cpu.y-e.cpu.height/2-i.BALL_RADIUS-5,e.ball.vx=0,e.ball.vy=0;else if(e.ball.inAir){if(l){e.ball.vy+=i.BALL_GRAVITY*t,e.ball.x+=e.ball.vx*t,e.ball.y+=e.ball.vy*t;const o=60,a=(n,r,s)=>{if(s.highJump>0&&!n.isGrounded){const d=e.ball.x-n.x,p=e.ball.y-(n.y-n.height/2);if(Math.sqrt(d*d+p*p)<o&&e.ball.shotFrom&&e.ball.shotFrom.shooter!==r)return e.ball.owner=r,e.ball.inAir=!1,e.ball.vx=0,e.ball.vy=0,e.ball.shotFrom=null,g("block"),f==="multiplayer"&&$(r),!0}return!1};a(e.player,"player",e.playerEffects)||a(e.cpu,"cpu",e.cpuEffects),e.ball.inAir&&e.ball.y>=i.COURT_FLOOR_Y&&(e.ball.y=i.COURT_FLOOR_Y,e.ball.vy*=-.6,e.ball.vx*=.8,Math.abs(e.ball.vy)<20&&(e.ball.inAir=!1,e.ball.vy=0)),e.ball.inAir&&(e.ball.x<i.BALL_RADIUS||e.ball.x>e.width-i.BALL_RADIUS)&&(e.ball.vx*=-.7,e.ball.x=Math.max(i.BALL_RADIUS,Math.min(e.width-i.BALL_RADIUS,e.ball.x))),le()}}else if(l){const o=Math.sqrt(Math.pow(e.ball.x-e.player.x,2)+Math.pow(e.ball.y-e.player.y,2)),a=Math.sqrt(Math.pow(e.ball.x-e.cpu.x,2)+Math.pow(e.ball.y-e.cpu.y,2));let n=null;o<i.STEAL_RANGE&&o<a?n="player":a<i.STEAL_RANGE&&a<=o&&(n="cpu"),n&&(e.ball.owner=n,g("pickup"),f==="multiplayer"&&$(n))}}function ge(){const t={x:i.HOOP_LEFT_X,y:i.HOOP_Y},l={x:i.HOOP_RIGHT_X,y:i.HOOP_Y};if(!e.ball.inAir||e.ball.vy<=0||!e.ball.shotFrom)return;const o=Math.abs(e.ball.shotFrom.x-e.ball.shotFrom.targetHoop);let a=i.HOOP_RADIUS;o<=150?a=i.HOOP_RADIUS+20:o<350?a=i.HOOP_RADIUS+5:a=i.HOOP_RADIUS-5;const n=f==="multiplayer"&&u.playerNumber===2?l:t,r=f==="multiplayer"&&u.playerNumber===2?t:l;if(Math.abs(e.ball.x-n.x)<a&&Math.abs(e.ball.y-n.y)<30&&e.ball.shotFrom.shooter==="player"){const s=X(e.ball.shotFrom);e.ball.shotFrom=null,j("player",s)}if(e.ball.shotFrom&&Math.abs(e.ball.x-r.x)<a&&Math.abs(e.ball.y-r.y)<30&&e.ball.shotFrom.shooter==="cpu"){const s=X(e.ball.shotFrom);e.ball.shotFrom=null,j("cpu",s)}}function X(t){const l=Math.abs(t.x-t.targetHoop);return l>=350?5:l>150?3:2}function j(t,l){e.score[t]+=l,T(),g("score"),t==="player"&&Ge(l);let o="";l===5?o="üî• 5 POINTS! Half-court shot!":l===3?o="üéØ 3-Pointer!":o="+2 Points";const a=t==="player"?o:`CPU Scores ${l} pts`;e.score[t]>=i.WIN_SCORE?(e.state=w.GAME_OVER,E(t==="player"?"YOU WIN! üèÜ":"CPU WINS!",null)):(E(a,1500),setTimeout(()=>{B(t),S()},1500))}function be(){e.state=w.GAME_OVER,e.score.player>e.score.cpu?E("TIME'S UP! YOU WIN! üèÜ",null):e.score.cpu>e.score.player?E("TIME'S UP! CPU WINS!",null):E("TIME'S UP! TIE GAME! ü§ù",null)}function xe(){const t=e.ctx;t.fillStyle="#16213e",t.fillRect(0,0,e.width,e.height),Ee(),K(i.HOOP_LEFT_X,i.HOOP_Y),K(i.HOOP_RIGHT_X,i.HOOP_Y);let l,o;f==="multiplayer"?u.playerNumber===1?(l="#4CAF50",o="#e94560"):(l="#e94560",o="#4CAF50"):(l="#4CAF50",o="#e94560"),z(e.cpu,o),z(e.player,l),ve(),we(),Re(),e.shotCharging&&(t.fillStyle="rgba(0, 50, 100, 0.15)",t.fillRect(0,0,e.width,e.height),Pe()),Te()}function Ee(){const t=e.ctx;t.fillStyle="#d4a574",t.fillRect(0,i.COURT_FLOOR_Y,e.width,e.height-i.COURT_FLOOR_Y),t.strokeStyle="#ffffff",t.lineWidth=3,t.beginPath(),t.moveTo(e.width/2,0),t.lineTo(e.width/2,i.COURT_FLOOR_Y),t.stroke(),t.strokeStyle="rgba(255, 255, 255, 0.3)",t.lineWidth=2,t.beginPath(),t.arc(i.HOOP_LEFT_X,i.COURT_FLOOR_Y,150,0,Math.PI,!0),t.stroke(),t.beginPath(),t.arc(i.HOOP_RIGHT_X,i.COURT_FLOOR_Y,150,0,Math.PI,!0),t.stroke()}function K(t,l,o){const a=e.ctx;a.fillStyle="rgba(255, 255, 255, 0.8)",a.fillRect(t-3,l-60,6,80),a.strokeStyle="#ff6b35",a.lineWidth=4,a.beginPath(),a.arc(t,l,i.HOOP_RADIUS,0,Math.PI),a.stroke(),a.strokeStyle="rgba(255, 255, 255, 0.4)",a.lineWidth=1;for(let n=-1;n<=1;n++)a.beginPath(),a.moveTo(t+n*20,l),a.lineTo(t+n*15,l+40),a.stroke()}function z(t,l){const o=e.ctx,a=t.x,n=t.y-t.height;o.fillStyle=l,o.fillRect(a-t.width/2,n,t.width,t.height),o.beginPath(),o.arc(a,n,12,0,Math.PI*2),o.fill(),t.defending&&(o.strokeStyle=l,o.lineWidth=4,o.beginPath(),o.moveTo(a-t.width/2,n+15),o.lineTo(a-t.width/2-20,n-10),o.stroke(),o.beginPath(),o.moveTo(a+t.width/2,n+15),o.lineTo(a+t.width/2+20,n-10),o.stroke()),o.strokeStyle="rgba(0, 0, 0, 0.3)",o.lineWidth=2,o.strokeRect(a-t.width/2,n,t.width,t.height)}function we(){const t=e.ctx,l=t.createRadialGradient(e.ball.x-3,e.ball.y-3,2,e.ball.x,e.ball.y,i.BALL_RADIUS);l.addColorStop(0,"#ff8c42"),l.addColorStop(1,"#ff6b35"),t.fillStyle=l,t.beginPath(),t.arc(e.ball.x,e.ball.y,i.BALL_RADIUS,0,Math.PI*2),t.fill(),t.strokeStyle="#d64933",t.lineWidth=2,t.stroke()}function Pe(){const t=e.ctx,l=f==="multiplayer"&&u.playerNumber===2?i.HOOP_RIGHT_X:i.HOOP_LEFT_X,o=i.HOOP_Y;t.strokeStyle="rgba(255, 215, 0, 0.6)",t.lineWidth=3,t.setLineDash([10,10]),t.beginPath(),t.moveTo(e.player.x,e.player.y-e.player.height/2),t.lineTo(l,o),t.stroke(),t.setLineDash([]),t.strokeStyle="rgba(255, 215, 0, 0.8)",t.lineWidth=3,t.beginPath(),t.arc(l,o,30,0,Math.PI*2),t.stroke(),t.beginPath(),t.moveTo(l-40,o),t.lineTo(l+40,o),t.moveTo(l,o-40),t.lineTo(l,o+40),t.stroke();const a=e.width/2-100,n=120,r=200,s=25;if(t.fillStyle="#fff",t.font="bold 18px Arial",t.textAlign="center",t.fillText(e.shotStage===1?"STEP 1: SET POWER":"STEP 2: SET ACCURACY",e.width/2,n-20),e.shotStage===1){t.fillStyle="rgba(0, 0, 0, 0.7)",t.fillRect(a-5,n-5,r+10,s+10),t.fillStyle="#333",t.fillRect(a,n,r,s),t.fillStyle="rgba(76, 175, 80, 0.4)",t.fillRect(a+r*.5,n,r*.5,s),t.fillStyle="rgba(255, 215, 0, 0.5)",t.fillRect(a+r*.75,n,r*.25,s);let d="#FF5722";e.shotPower>=75?d="#FFD700":e.shotPower>=50&&(d="#4CAF50"),t.fillStyle=d,t.fillRect(a,n,r*(e.shotPower/100),s),t.fillStyle="#fff",t.font="bold 14px Arial",t.textAlign="center",t.fillText("POWER",a+r/2,n-10),t.font="16px Arial",t.fillStyle="rgba(255, 255, 255, 0.9)",t.fillText("Click when in GOLD zone!",a+r/2,n+50)}else if(e.shotStage===2){t.fillStyle="#FFD700",t.font="bold 16px Arial",t.textAlign="center";let d="Power: ";e.lockedPower>=75?d+="PERFECT! ‚≠ê":e.lockedPower>=50?d+="Good":d+="Weak",t.fillText(d,e.width/2,n-40)}if(e.shotStage===2){const d=n;t.fillStyle="rgba(0, 0, 0, 0.7)",t.fillRect(a-5,d-5,r+10,s+10),t.fillStyle="#333",t.fillRect(a,d,r,s),t.fillStyle="rgba(76, 175, 80, 0.6)",t.fillRect(a+r*.4,d,r*.2,s),t.fillStyle="rgba(255, 255, 0, 0.4)",t.fillRect(a+r*.45,d,r*.1,s);const p=a+r*(e.shotAccuracy/100);t.fillStyle="#FF5722",t.fillRect(p-3,d-2,6,s+4),t.fillStyle="#fff",t.font="bold 14px Arial",t.fillText("ACCURACY",a+r/2,d-10),t.font="16px Arial",t.fillStyle="rgba(255, 255, 255, 0.9)",t.fillText("Click when PERFECT!",a+r/2,d+50);const y=Math.abs(e.shotAccuracy-50);let b="",m="";y<=10?(b="PERFECT! ‚≠ê",m="#FFD700"):y<=20?(b="Good",m="#4CAF50"):(b="Poor",m="#FF5722"),t.fillStyle=m,t.font="bold 18px Arial",t.fillText(b,a+r/2,d+70)}}function ve(){const t=e.ctx;for(const l of e.powerups){const o=k.find(n=>n.id===l.type);if(!o)continue;const a=l.y+Math.sin(l.age*3+l.bobOffset)*6;t.save(),t.shadowColor=o.color,t.shadowBlur=15+Math.sin(l.age*4)*5,t.fillStyle=o.color,t.globalAlpha=.3,t.beginPath(),t.arc(l.x,a,i.POWERUP_SIZE+4,0,Math.PI*2),t.fill(),t.globalAlpha=.9,t.fillStyle=o.color,t.beginPath(),t.arc(l.x,a,i.POWERUP_SIZE,0,Math.PI*2),t.fill(),t.strokeStyle="#fff",t.lineWidth=2,t.stroke(),t.shadowBlur=0,t.globalAlpha=1,t.fillStyle="#fff",t.font="bold 18px Arial",t.textAlign="center",t.textBaseline="middle",t.fillText(o.icon,l.x,a),t.restore()}}function Re(){const t=e.ctx,l=(o,a)=>{let n=[];a.speed>0&&n.push({color:"#00E5FF",icon:"‚ö°",time:a.speed}),a.highJump>0&&n.push({color:"#76FF03",icon:"ü¶ò",time:a.highJump});for(let r=0;r<n.length;r++){const s=n[r],d=o.x-(n.length-1)*12+r*24,p=o.y-o.height-30;s.time<2&&Math.floor(s.time*4)%2===0||(t.save(),t.shadowColor=s.color,t.shadowBlur=8,t.fillStyle=s.color,t.globalAlpha=.8,t.beginPath(),t.arc(d,p,10,0,Math.PI*2),t.fill(),t.shadowBlur=0,t.globalAlpha=1,t.fillStyle="#fff",t.font="12px Arial",t.textAlign="center",t.textBaseline="middle",t.fillText(s.icon,d,p),t.restore())}};l(e.player,e.playerEffects),l(e.cpu,e.cpuEffects)}function Te(){const t=e.ctx;t.fillStyle="rgba(255, 255, 255, 0.7)",t.font="14px Arial",t.textAlign="left",se()||t.fillText("CONTROLS: Arrow Keys/WASD = Move | SPACE = Jump | CLICK = Shoot | D = Defend",10,20),t.fillText("First to 21 wins! | 2pts (inside arc) | 3pts (outside arc) | 5pts (half-court)",10,40);const l=Math.floor(e.timeRemaining/60),o=Math.floor(e.timeRemaining%60),a=`${l}:${o.toString().padStart(2,"0")}`;t.font="bold 24px Arial",t.textAlign="center",t.fillStyle=e.timeRemaining<30?"#FF5722":"#fff",t.fillText(a,e.width/2,60)}function Ie(){document.getElementById("restart-btn").addEventListener("click",ee),document.getElementById("mute-btn").addEventListener("click",Ae),T()}function T(){document.getElementById("level-number").textContent=`${e.score.player} - ${e.score.cpu}`}function E(t,l){const o=document.getElementById("message");o.textContent=t,o.classList.add("show"),l&&setTimeout(()=>S(),l)}function S(){document.getElementById("message").classList.remove("show")}function Ae(){e.muted=!e.muted,document.getElementById("mute-btn").textContent=e.muted?"üîá":"üîä"}let M=null;function Oe(){return M||(M=new(window.AudioContext||window.webkitAudioContext)),M}function g(t){if(!e.muted)try{const l=Oe(),o=l.createOscillator(),a=l.createGain();o.connect(a),a.connect(l.destination);const n=l.currentTime;t==="jump"?(o.frequency.setValueAtTime(200,n),o.frequency.exponentialRampToValueAtTime(100,n+.1),a.gain.setValueAtTime(.08,n),a.gain.exponentialRampToValueAtTime(.01,n+.1),o.start(n),o.stop(n+.1)):t==="shoot"?(o.frequency.setValueAtTime(300,n),o.frequency.exponentialRampToValueAtTime(150,n+.15),a.gain.setValueAtTime(.1,n),a.gain.exponentialRampToValueAtTime(.01,n+.15),o.start(n),o.stop(n+.15)):t==="score"?(o.frequency.setValueAtTime(440,n),o.frequency.exponentialRampToValueAtTime(880,n+.2),a.gain.setValueAtTime(.12,n),a.gain.exponentialRampToValueAtTime(.01,n+.2),o.start(n),o.stop(n+.2)):t==="block"?(o.type="square",o.frequency.setValueAtTime(100,n),a.gain.setValueAtTime(.1,n),a.gain.exponentialRampToValueAtTime(.01,n+.1),o.start(n),o.stop(n+.1)):t==="pickup"&&(o.frequency.setValueAtTime(400,n),a.gain.setValueAtTime(.05,n),a.gain.exponentialRampToValueAtTime(.01,n+.05),o.start(n),o.stop(n+.05))}catch(l){console.warn("Audio error:",l)}}let h=!1,x=!1;function Se(){try{c=io({transports:["websocket","polling"],timeout:5e3}),c.on("connect",()=>{console.log("Connected to server"),document.getElementById("lobby-status").textContent="Connected! Searching for opponent..."}),c.on("connect_error",t=>{console.error("Connection error:",t),document.getElementById("lobby-status").textContent="Connection failed. Please check server."}),c.on("waitingForOpponent",()=>{document.getElementById("lobby-status").textContent="Searching for opponent..."})}catch(t){console.error("Socket initialization error:",t),document.getElementById("lobby-status").textContent="Connection failed."}c.on("matchFound",t=>{u.roomId=t.roomId,u.playerNumber=t.playerNumber,u.opponentId=t.opponentId,h=!1,x=!1,Le()}),c.on("opponentReadyState",t=>{x=t.ready,G(),h&&x&&F()}),c.on("bothReady",()=>{F()}),c.on("opponentLeftLobby",()=>{h=!1,x=!1,document.getElementById("lobby-status").textContent="Opponent left. Searching again...",te(),c&&c.connected&&c.emit("findMatch")}),c.on("opponentMove",t=>{f==="multiplayer"&&(e.cpu.x=t.x,e.cpu.y=t.y,e.cpu.vx=t.vx,e.cpu.vy=t.vy,e.cpu.isGrounded=t.isGrounded,e.cpu.defending=t.defending)}),c.on("ballSync",t=>{f==="multiplayer"&&u.playerNumber===2&&(e.ball.x=t.x,e.ball.y=t.y,e.ball.vx=t.vx,e.ball.vy=t.vy,e.ball.inAir=t.inAir,t.owner==="player"?e.ball.owner="cpu":t.owner==="cpu"?e.ball.owner="player":e.ball.owner=t.owner,t.shotFrom?e.ball.shotFrom={...t.shotFrom,shooter:t.shotFrom.shooter==="player"?"cpu":"player"}:e.ball.shotFrom=null)}),c.on("scoreUpdate",t=>{f==="multiplayer"&&(u.playerNumber===1?(e.score.player=t.score.player1,e.score.cpu=t.score.player2):(e.score.player=t.score.player2,e.score.cpu=t.score.player1),T())}),c.on("opponentDisconnected",()=>{E("Opponent disconnected",null),setTimeout(()=>{O()},2e3)}),c.on("opponentLeft",()=>{E("Opponent left the game",null),setTimeout(()=>{O()},2e3)}),c.on("ballPickupSync",t=>{f==="multiplayer"&&(u.playerNumber===2?t.owner==="player"?e.ball.owner="cpu":t.owner==="cpu"?e.ball.owner="player":e.ball.owner=t.owner:e.ball.owner=t.owner,g("pickup"))})}function te(){document.getElementById("main-menu").style.display="none",document.getElementById("ready-lobby").style.display="none",document.getElementById("game-container").style.display="none",document.getElementById("matchmaking-lobby").style.display="block"}function Le(){document.getElementById("main-menu").style.display="none",document.getElementById("matchmaking-lobby").style.display="none",document.getElementById("game-container").style.display="none",document.getElementById("ready-lobby").style.display="block",G();const t=document.getElementById("ready-btn");t.textContent="Ready!",t.classList.remove("is-ready")}function G(){const t=document.getElementById("your-ready-status"),l=document.getElementById("opponent-ready-status");h?(t.textContent="Ready!",t.classList.remove("not-ready"),t.classList.add("ready")):(t.textContent="Not Ready",t.classList.remove("ready"),t.classList.add("not-ready")),x?(l.textContent="Ready!",l.classList.remove("not-ready"),l.classList.add("ready")):(l.textContent="Not Ready",l.classList.remove("ready"),l.classList.add("not-ready"))}function _e(){h=!h;const t=document.getElementById("ready-btn");h?(t.textContent="Waiting...",t.classList.add("is-ready")):(t.textContent="Ready!",t.classList.remove("is-ready")),G(),c&&u.roomId&&c.emit("playerReady",{roomId:u.roomId,ready:h}),h&&x&&F()}function F(){const t=document.createElement("div");t.className="countdown-overlay",t.id="countdown-overlay",document.body.appendChild(t);let l=3;function o(){l>0?(t.innerHTML=`<div class="countdown-number">${l}</div>`,l--,setTimeout(o,1e3)):(t.innerHTML='<div class="countdown-number">GO!</div>',setTimeout(()=>{t.remove(),Me()},500))}o()}function Me(){f="multiplayer",document.getElementById("main-menu").style.display="none",document.getElementById("matchmaking-lobby").style.display="none",document.getElementById("ready-lobby").style.display="none",document.getElementById("game-container").style.display="block",Q()}function Ce(){f="singleplayer",document.getElementById("main-menu").style.display="none",document.getElementById("matchmaking-lobby").style.display="none",document.getElementById("ready-lobby").style.display="none",document.getElementById("game-container").style.display="block",Q()}function O(){f="singleplayer";const t=u.roomId;u={roomId:null,playerNumber:null,opponentId:null},h=!1,x=!1,document.getElementById("game-container").style.display="none",document.getElementById("matchmaking-lobby").style.display="none",document.getElementById("ready-lobby").style.display="none",document.getElementById("main-menu").style.display="block",document.getElementById("connection-status").textContent="";const l=document.getElementById("countdown-overlay");l&&l.remove(),c&&t&&c.emit("leaveRoom",{roomId:t})}function ke(){c&&c.emit("cancelSearch"),O()}function Fe(){c&&u.roomId&&c.emit("leaveLobby",{roomId:u.roomId}),O()}function Be(){f==="multiplayer"&&c&&u.roomId&&c.emit("playerMove",{roomId:u.roomId,x:e.player.x,y:e.player.y,vx:e.player.vx,vy:e.player.vy,isGrounded:e.player.isGrounded,defending:e.player.defending})}function le(){f==="multiplayer"&&c&&u.roomId&&c.emit("ballUpdate",{roomId:u.roomId,x:e.ball.x,y:e.ball.y,vx:e.ball.vx,vy:e.ball.vy,inAir:e.ball.inAir,owner:e.ball.owner,shotFrom:e.ball.shotFrom})}function Ge(t){f==="multiplayer"&&c&&u.roomId&&c.emit("playerScored",{roomId:u.roomId,scorer:u.playerNumber,points:t})}function $(t){f==="multiplayer"&&c&&u.roomId&&c.emit("ballPickup",{roomId:u.roomId,owner:t})}window.addEventListener("DOMContentLoaded",()=>{console.log("DOM loaded, setting up menu...");const t=document.getElementById("vs-cpu-btn"),l=document.getElementById("multiplayer-btn"),o=document.getElementById("cancel-search-btn"),a=document.getElementById("ready-btn"),n=document.getElementById("leave-lobby-btn");t&&t.addEventListener("click",()=>{console.log("Single player clicked"),Ce()}),l&&l.addEventListener("click",()=>{console.log("Multiplayer clicked"),te(),document.getElementById("lobby-status").textContent="Connecting to server...",c||Se(),setTimeout(()=>{c&&c.connected?(document.getElementById("lobby-status").textContent="Searching for opponent...",c.emit("findMatch")):document.getElementById("lobby-status").textContent="Connection failed. Please try again."},500)}),o&&o.addEventListener("click",()=>{console.log("Cancel search clicked"),ke()}),a&&a.addEventListener("click",()=>{console.log("Ready clicked"),_e()}),n&&n.addEventListener("click",()=>{console.log("Leave lobby clicked"),Fe()})});
